module.exports = [
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/shared/lib/no-fallback-error.external.js [external] (next/dist/shared/lib/no-fallback-error.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/shared/lib/no-fallback-error.external.js", () => require("next/dist/shared/lib/no-fallback-error.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/@prisma/client [external] (@prisma/client, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("@prisma/client", () => require("@prisma/client"));

module.exports = mod;
}),
"[externals]/pg [external] (pg, esm_import)", ((__turbopack_context__) => {
"use strict";

return __turbopack_context__.a(async (__turbopack_handle_async_dependencies__, __turbopack_async_result__) => { try {

const mod = await __turbopack_context__.y("pg");

__turbopack_context__.n(mod);
__turbopack_async_result__();
} catch(e) { __turbopack_async_result__(e); } }, true);}),
"[externals]/fs [external] (fs, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("fs", () => require("fs"));

module.exports = mod;
}),
"[externals]/path [external] (path, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("path", () => require("path"));

module.exports = mod;
}),
"[project]/src/lib/prisma.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

return __turbopack_context__.a(async (__turbopack_handle_async_dependencies__, __turbopack_async_result__) => { try {

__turbopack_context__.s([
    "default",
    ()=>__TURBOPACK__default__export__,
    "prisma",
    ()=>prisma
]);
var __TURBOPACK__imported__module__$5b$externals$5d2f40$prisma$2f$client__$5b$external$5d$__$2840$prisma$2f$client$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/@prisma/client [external] (@prisma/client, cjs)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$prisma$2f$adapter$2d$pg$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@prisma/adapter-pg/dist/index.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$pg__$5b$external$5d$__$28$pg$2c$__esm_import$29$__ = __turbopack_context__.i("[externals]/pg [external] (pg, esm_import)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$fs__$5b$external$5d$__$28$fs$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/fs [external] (fs, cjs)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$path__$5b$external$5d$__$28$path$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/path [external] (path, cjs)");
var __turbopack_async_dependencies__ = __turbopack_handle_async_dependencies__([
    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$prisma$2f$adapter$2d$pg$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__,
    __TURBOPACK__imported__module__$5b$externals$5d2f$pg__$5b$external$5d$__$28$pg$2c$__esm_import$29$__
]);
[__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$prisma$2f$adapter$2d$pg$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__, __TURBOPACK__imported__module__$5b$externals$5d2f$pg__$5b$external$5d$__$28$pg$2c$__esm_import$29$__] = __turbopack_async_dependencies__.then ? (await __turbopack_async_dependencies__)() : __turbopack_async_dependencies__;
;
;
;
;
;
const connectionString = process.env.DATABASE_URL;
if (!connectionString) {
    throw new Error("DATABASE_URL is required to initialize Prisma");
}
// Ensure a single PrismaClient/Pool instance across hot reloads in dev.
const globalForPrisma = globalThis;
const defaultCaPath = process.env.NODE_EXTRA_CA_CERTS || __TURBOPACK__imported__module__$5b$externals$5d2f$path__$5b$external$5d$__$28$path$2c$__cjs$29$__["default"].join(process.cwd(), "prod-ca-2021.crt");
const caFileExists = ("TURBOPACK compile-time truthy", 1) ? __TURBOPACK__imported__module__$5b$externals$5d2f$fs__$5b$external$5d$__$28$fs$2c$__cjs$29$__["default"].existsSync(defaultCaPath) : "TURBOPACK unreachable";
const caBuffer = caFileExists ? __TURBOPACK__imported__module__$5b$externals$5d2f$fs__$5b$external$5d$__$28$fs$2c$__cjs$29$__["default"].readFileSync(defaultCaPath) : undefined;
const allowInsecureEnv = process.env.DB_SSL_ALLOW_INSECURE === "1" || process.env.DB_SSL_ALLOW_INSECURE === "true" || process.env.NODE_TLS_REJECT_UNAUTHORIZED === "0";
const connectionTimeoutMs = Number.parseInt(process.env.DB_CONNECTION_TIMEOUT_MS ?? "", 10) || 5000;
const buildPool = (rejectUnauthorized)=>{
    const ssl = {
        rejectUnauthorized
    };
    if (caBuffer) {
        ssl.ca = caBuffer;
    }
    return {
        pool: new __TURBOPACK__imported__module__$5b$externals$5d2f$pg__$5b$external$5d$__$28$pg$2c$__esm_import$29$__["Pool"]({
            connectionString,
            ssl,
            connectionTimeoutMillis: connectionTimeoutMs
        }),
        usedInsecure: !rejectUnauthorized
    };
};
const isTlsError = (error)=>{
    if (!error || typeof error !== "object") return false;
    const code = error.code ?? "";
    const message = error.message ?? "";
    const tlsCodes = [
        "SELF_SIGNED_CERT_IN_CHAIN",
        "DEPTH_ZERO_SELF_SIGNED_CERT",
        "UNABLE_TO_VERIFY_LEAF_SIGNATURE",
        "ERR_TLS_CERT_ALTNAME_INVALID",
        "UNABLE_TO_GET_ISSUER_CERT_LOCALLY"
    ];
    return tlsCodes.includes(code) || message.toLowerCase().includes("certificate");
};
const initPool = async ()=>{
    const primary = buildPool(!allowInsecureEnv);
    const warmupResult = await primary.pool.query("SELECT 1").then(()=>"ok").catch((error)=>{
        if (!allowInsecureEnv && isTlsError(error)) {
            return "tls-error";
        }
        console.warn("Database warm-up query failed; continuing with current SSL config.", error);
        return "failed";
    });
    if (warmupResult === "tls-error") {
        await primary.pool.end().catch(()=>{});
        console.warn("Database TLS verification failed; retrying with rejectUnauthorized=false. " + "Provide NODE_EXTRA_CA_CERTS with your trusted root to restore verification.");
        return buildPool(false);
    }
    return primary;
};
const { pool, usedInsecure } = globalForPrisma.pool && typeof globalForPrisma.__dbUsedInsecureSsl === "boolean" ? {
    pool: globalForPrisma.pool,
    usedInsecure: globalForPrisma.__dbUsedInsecureSsl
} : await initPool();
const adapter = globalForPrisma.adapter ?? new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$prisma$2f$adapter$2d$pg$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["PrismaPg"](pool);
const prisma = globalForPrisma.prisma ?? new __TURBOPACK__imported__module__$5b$externals$5d2f40$prisma$2f$client__$5b$external$5d$__$2840$prisma$2f$client$2c$__cjs$29$__["PrismaClient"]({
    adapter,
    log: ("TURBOPACK compile-time truthy", 1) ? [
        "warn",
        "error"
    ] : "TURBOPACK unreachable"
});
if ("TURBOPACK compile-time truthy", 1) {
    globalForPrisma.pool = pool;
    globalForPrisma.adapter = adapter;
    globalForPrisma.prisma = prisma;
    globalForPrisma.__dbUsedInsecureSsl = usedInsecure;
}
const __TURBOPACK__default__export__ = prisma;
__turbopack_async_result__();
} catch(e) { __turbopack_async_result__(e); } }, true);}),
"[project]/src/app/api/hr-picks/route.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

return __turbopack_context__.a(async (__turbopack_handle_async_dependencies__, __turbopack_async_result__) => { try {

__turbopack_context__.s([
    "GET",
    ()=>GET
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/prisma.ts [app-route] (ecmascript)");
var __turbopack_async_dependencies__ = __turbopack_handle_async_dependencies__([
    __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__
]);
[__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__] = __turbopack_async_dependencies__.then ? (await __turbopack_async_dependencies__)() : __turbopack_async_dependencies__;
;
;
const parseDate = (value)=>{
    if (!value) return null;
    const parsed = new Date(`${value}T00:00:00.000Z`);
    return Number.isNaN(parsed.getTime()) ? null : parsed;
};
async function GET(req) {
    const { searchParams } = new URL(req.url);
    const dateParam = searchParams.get("date");
    const date = parseDate(dateParam);
    if (!dateParam || !date) {
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: "date query param is required (YYYY-MM-DD)"
        }, {
            status: 400
        });
    }
    const endOfDay = new Date(date);
    endOfDay.setUTCDate(endOfDay.getUTCDate() + 1);
    try {
        const games = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].game.findMany({
            where: {
                date: {
                    gte: date,
                    lt: endOfDay
                }
            },
            orderBy: {
                date: "asc"
            },
            include: {
                homeTeam: true,
                awayTeam: true,
                park: {
                    include: {
                        parkHrFactors: {
                            orderBy: {
                                updatedAt: "desc"
                            },
                            take: 1
                        }
                    }
                },
                gamePredictions: true
            }
        });
        if (!games || games.length === 0) {
            const empty = {
                date: dateParam,
                picks: []
            };
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json(empty, {
                status: 200
            });
        }
        const season = games[0].season;
        const teamIds = Array.from(new Set(games.flatMap((g)=>[
                g.homeTeamId,
                g.awayTeamId
            ])));
        const players = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].player.findMany({
            where: {
                teamId: {
                    in: teamIds
                }
            },
            include: {
                team: true,
                hrSummaries: {
                    where: {
                        season
                    }
                }
            }
        });
        const predictionsByTeam = new Map();
        for (const game of games){
            for (const pred of game.gamePredictions){
                predictionsByTeam.set(pred.teamId, pred.hotbatScore);
            }
        }
        const parkFactorsByTeam = new Map();
        for (const game of games){
            const parkFactorEntry = game.park.parkHrFactors[0];
            const factor = parkFactorEntry?.hrFactor ?? game.park.defaultHrFactor ?? undefined;
            parkFactorsByTeam.set(game.homeTeamId, {
                parkName: game.park.name,
                hrFactor: factor
            });
            parkFactorsByTeam.set(game.awayTeamId, {
                parkName: game.park.name,
                hrFactor: factor
            });
        }
        const picksUnsorted = [];
        for (const player of players){
            const overallSummary = player.hrSummaries.find((s)=>s.splitKey === "overall");
            const hrPerPa = Number.isFinite(overallSummary?.hrPerPa ?? 0) ? overallSummary?.hrPerPa : 0;
            const hr = Number.isFinite(overallSummary?.hr ?? 0) ? overallSummary?.hr : 0;
            const hotbatScore = predictionsByTeam.get(player.teamId) ?? 0;
            // Deterministic, player-informed ranking: team HotBat score + HR/PA + HR tiebreak.
            const pickScore = hotbatScore + hrPerPa * 100 + hr * 0.1;
            const parkInfo = parkFactorsByTeam.get(player.teamId);
            const reasons = [];
            if (hotbatScore >= 75) {
                reasons.push(`Elite power profile (team HotBat Score ${hotbatScore.toFixed(1)})`);
            } else if (hotbatScore > 0) {
                reasons.push(`Team HotBat Score ${hotbatScore.toFixed(1)}`);
            }
            if (parkInfo?.hrFactor && parkInfo.hrFactor > 1.1) {
                reasons.push(`HR-friendly park at ${parkInfo.parkName}`);
            }
            if (hrPerPa >= 0.25) {
                reasons.push(`Strong HR/PA (${hrPerPa.toFixed(3)})`);
            }
            if (hr > 0 && reasons.length < 3) {
                reasons.push(`Season HR total ${hr}`);
            }
            if (!reasons.length && parkInfo?.parkName) {
                reasons.push(`Playing at ${parkInfo.parkName}`);
            }
            picksUnsorted.push({
                playerId: player.id,
                playerName: `${player.firstName} ${player.lastName}`,
                teamAbbrev: player.team.abbrev,
                hotbatScore,
                pickScore,
                reasons,
                parkName: parkInfo?.parkName,
                parkHrFactor: parkInfo?.hrFactor,
                hrPerPa,
                seasonHr: hr
            });
        }
        const sorted = picksUnsorted.sort((a, b)=>{
            if (b.pickScore !== a.pickScore) return b.pickScore - a.pickScore;
            if (b.hotbatScore !== a.hotbatScore) return b.hotbatScore - a.hotbatScore;
            if (b.reasons.length !== a.reasons.length) return b.reasons.length - a.reasons.length;
            return b.playerName.localeCompare(a.playerName);
        }).slice(0, 5);
        const picks = sorted.map((p, idx)=>({
                rank: idx + 1,
                ...p
            }));
        const response = {
            date: dateParam,
            picks
        };
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json(response, {
            status: 200
        });
    } catch (error) {
        console.error("hr-picks handler error", error);
        const fallback = {
            date: dateParam ?? "",
            picks: []
        };
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json(fallback, {
            status: 500,
            headers: {
                "x-hotbat-error": "1"
            }
        });
    }
}
__turbopack_async_result__();
} catch(e) { __turbopack_async_result__(e); } }, false);}),
];

//# sourceMappingURL=%5Broot-of-the-server%5D__60fae4b5._.js.map