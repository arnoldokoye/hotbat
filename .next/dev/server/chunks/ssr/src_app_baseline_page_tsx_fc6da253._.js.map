{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/arnoldokoye/hotbat/src/app/baseline/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useMemo, useState } from \"react\";\n\ntype PlayerGameBaselineRow = {\n  player_id: string;\n  player_name: string;\n  game_date: string;\n  park_id: string;\n  opposing_pitcher_id: string;\n  hr_rate_last_50: number;\n  season_hr_rate: number;\n  park_hr_factor: number;\n  expected_pa: number;\n  baseline_hr_score: number;\n};\n\nconst BASELINE_CSV_PATH = \"/data/player_game_baseline.csv\";\n\nfunction parseNumber(value: string): number {\n  const n = Number(value);\n  return Number.isFinite(n) ? n : 0;\n}\n\nfunction splitCsvLine(line: string): string[] {\n  const out: string[] = [];\n  let cur = \"\";\n  let inQuotes = false;\n\n  for (let i = 0; i < line.length; i += 1) {\n    const ch = line[i];\n\n    if (ch === '\"') {\n      if (inQuotes && line[i + 1] === '\"') {\n        cur += '\"';\n        i += 1;\n        continue;\n      }\n      inQuotes = !inQuotes;\n      continue;\n    }\n\n    if (ch === \",\" && !inQuotes) {\n      out.push(cur);\n      cur = \"\";\n      continue;\n    }\n\n    cur += ch;\n  }\n\n  out.push(cur);\n  return out;\n}\n\nfunction parseBaselineCsv(csvText: string): PlayerGameBaselineRow[] {\n  const text = csvText.replace(/^\\uFEFF/, \"\").trim();\n  if (!text) return [];\n\n  const lines = text.split(/\\r?\\n/).filter(Boolean);\n  if (lines.length < 2) return [];\n\n  const header = splitCsvLine(lines[0]).map((h) => h.trim());\n  const idx = new Map(header.map((h, i) => [h, i]));\n\n  function getCell(cells: string[], key: string): string {\n    const i = idx.get(key);\n    return i === undefined ? \"\" : (cells[i] ?? \"\").trim();\n  }\n\n  const rows: PlayerGameBaselineRow[] = [];\n  for (const line of lines.slice(1)) {\n    const cells = splitCsvLine(line);\n\n    const player_id = getCell(cells, \"player_id\");\n    const game_date = getCell(cells, \"game_date\");\n    if (!player_id || !game_date) continue;\n\n    const player_name =\n      getCell(cells, \"player_name\") ||\n      getCell(cells, \"full_name\") ||\n      player_id;\n\n    rows.push({\n      player_id,\n      player_name,\n      game_date,\n      park_id: getCell(cells, \"park_id\"),\n      opposing_pitcher_id: getCell(cells, \"opposing_pitcher_id\"),\n      hr_rate_last_50: parseNumber(getCell(cells, \"hr_rate_last_50\")),\n      season_hr_rate: parseNumber(getCell(cells, \"season_hr_rate\")),\n      park_hr_factor: parseNumber(getCell(cells, \"park_hr_factor\")),\n      expected_pa: parseNumber(getCell(cells, \"expected_pa\")),\n      baseline_hr_score: parseNumber(getCell(cells, \"baseline_hr_score\")),\n    });\n  }\n\n  return rows;\n}\n\nexport default function BaselinePage() {\n  const [rows, setRows] = useState<PlayerGameBaselineRow[] | null>(null);\n  const [error, setError] = useState<string | null>(null);\n  const [selectedDate, setSelectedDate] = useState<string>(\"\");\n\n  useEffect(() => {\n    let cancelled = false;\n\n    async function load() {\n      try {\n        setError(null);\n        const res = await fetch(BASELINE_CSV_PATH, { cache: \"no-store\" });\n        if (!res.ok) {\n          throw new Error(\n            `Missing baseline file at ${BASELINE_CSV_PATH} (HTTP ${res.status}).`,\n          );\n        }\n        const text = await res.text();\n        const parsed = parseBaselineCsv(text);\n        if (cancelled) return;\n        setRows(parsed);\n\n        const dates = Array.from(new Set(parsed.map((r) => r.game_date))).sort();\n        setSelectedDate((prev) => prev || dates[dates.length - 1] || \"\");\n      } catch (e) {\n        if (cancelled) return;\n        setRows([]);\n        setError(e instanceof Error ? e.message : String(e));\n      }\n    }\n\n    load();\n    return () => {\n      cancelled = true;\n    };\n  }, []);\n\n  const dates = useMemo(() => {\n    if (!rows) return [];\n    return Array.from(new Set(rows.map((r) => r.game_date))).sort();\n  }, [rows]);\n\n  const ranked = useMemo(() => {\n    if (!rows) return [];\n    const filtered = selectedDate\n      ? rows.filter((r) => r.game_date === selectedDate)\n      : rows;\n    return filtered\n      .slice()\n      .sort((a, b) => {\n        if (b.baseline_hr_score !== a.baseline_hr_score)\n          return b.baseline_hr_score - a.baseline_hr_score;\n        if (b.hr_rate_last_50 !== a.hr_rate_last_50)\n          return b.hr_rate_last_50 - a.hr_rate_last_50;\n        return a.player_id.localeCompare(b.player_id);\n      })\n      .slice(0, 25);\n  }, [rows, selectedDate]);\n\n  return (\n    <div className=\"flex flex-col gap-4\">\n      <div className=\"flex flex-col gap-1\">\n        <h1 className=\"text-2xl font-bold tracking-tight\">HR Picks (Baseline)</h1>\n        <p className=\"text-sm text-slate-600 dark:text-slate-400\">\n          Source: <span className=\"font-mono\">{BASELINE_CSV_PATH}</span>\n        </p>\n      </div>\n\n      {error ? (\n        <div className=\"rounded-lg border border-amber-200 bg-amber-50 p-4 text-sm text-amber-900 dark:border-amber-900/40 dark:bg-amber-950/30 dark:text-amber-200\">\n          <p className=\"font-semibold\">Baseline file not found</p>\n          <p className=\"mt-1\">{error}</p>\n          <p className=\"mt-3 font-mono text-xs whitespace-pre-wrap\">\n            {`mkdir -p public/data\ncp scripts/ml/data/player_game_baseline.csv public/data/player_game_baseline.csv`}\n          </p>\n          <p className=\"mt-2\">\n            Then refresh this page:{\" \"}\n            <span className=\"font-mono\">/baseline</span>\n          </p>\n        </div>\n      ) : null}\n\n      <div className=\"flex flex-col gap-3 rounded-lg border border-slate-200 bg-white p-4 dark:border-slate-800 dark:bg-slate-950\">\n        <div className=\"flex flex-col gap-2 sm:flex-row sm:items-end sm:justify-between\">\n          <div className=\"flex flex-col gap-1\">\n            <label className=\"text-xs font-semibold uppercase tracking-wide text-slate-500 dark:text-slate-400\">\n              Date\n            </label>\n            <select\n              className=\"w-full rounded-md border border-slate-200 bg-white px-3 py-2 text-sm shadow-sm dark:border-slate-800 dark:bg-slate-950\"\n              value={selectedDate}\n              onChange={(e) => setSelectedDate(e.target.value)}\n              disabled={!dates.length}\n            >\n              {dates.length ? null : <option value=\"\">No dates loaded</option>}\n              {dates.map((d) => (\n                <option key={d} value={d}>\n                  {d}\n                </option>\n              ))}\n            </select>\n          </div>\n\n          <div className=\"text-sm text-slate-600 dark:text-slate-400\">\n            Showing <span className=\"font-semibold\">{ranked.length}</span>{\" \"}\n            players\n          </div>\n        </div>\n\n        <div className=\"overflow-x-auto\">\n          <table className=\"w-full text-left text-sm\">\n            <thead className=\"border-b border-slate-200 text-xs uppercase tracking-wide text-slate-500 dark:border-slate-800 dark:text-slate-400\">\n              <tr>\n                <th className=\"py-2 pr-4\">#</th>\n                <th className=\"py-2 pr-4\">Player</th>\n                <th className=\"py-2 pr-4\">HR Score</th>\n                <th className=\"py-2 pr-4\">Last 50</th>\n                <th className=\"py-2 pr-4\">Season</th>\n                <th className=\"py-2 pr-4\">Park</th>\n                <th className=\"py-2 pr-4\">Exp PA</th>\n              </tr>\n            </thead>\n            <tbody>\n              {rows === null ? (\n                <tr>\n                  <td className=\"py-4 text-slate-500 dark:text-slate-400\" colSpan={7}>\n                    Loading…\n                  </td>\n                </tr>\n              ) : ranked.length ? (\n                ranked.map((r, i) => (\n                  <tr\n                    key={`${r.player_id}:${r.game_date}`}\n                    className=\"border-b border-slate-100 last:border-b-0 dark:border-slate-900\"\n                  >\n                    <td className=\"py-2 pr-4 tabular-nums text-slate-500 dark:text-slate-400\">\n                      {i + 1}\n                    </td>\n                    <td className=\"py-2 pr-4\">\n                      <div className=\"font-medium\">{r.player_name}</div>\n                      {r.player_name !== r.player_id ? (\n                        <div className=\"mt-0.5 text-xs font-mono text-slate-500 dark:text-slate-400\">\n                          {r.player_id}\n                        </div>\n                      ) : null}\n                    </td>\n                    <td className=\"py-2 pr-4 tabular-nums font-semibold\">\n                      {r.baseline_hr_score.toFixed(3)}\n                    </td>\n                    <td className=\"py-2 pr-4 tabular-nums\">\n                      {(r.hr_rate_last_50 * 100).toFixed(1)}%\n                    </td>\n                    <td className=\"py-2 pr-4 tabular-nums\">\n                      {(r.season_hr_rate * 100).toFixed(1)}%\n                    </td>\n                    <td className=\"py-2 pr-4 tabular-nums\">\n                      {r.park_hr_factor ? r.park_hr_factor.toFixed(2) : \"—\"}\n                    </td>\n                    <td className=\"py-2 pr-4 tabular-nums\">\n                      {r.expected_pa ? r.expected_pa.toFixed(1) : \"—\"}\n                    </td>\n                  </tr>\n                ))\n              ) : (\n                <tr>\n                  <td className=\"py-4 text-slate-500 dark:text-slate-400\" colSpan={7}>\n                    No rows for this date.\n                  </td>\n                </tr>\n              )}\n            </tbody>\n          </table>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}