{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file:///Users/arnoldokoye/hotbat/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\nimport { PrismaPg } from \"@prisma/adapter-pg\";\nimport { Pool } from \"pg\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nconst connectionString = process.env.DATABASE_URL;\nif (!connectionString) {\n  throw new Error(\"DATABASE_URL is required to initialize Prisma\");\n}\n\n// Ensure a single PrismaClient/Pool instance across hot reloads in dev.\nconst globalForPrisma = globalThis as unknown as {\n  prisma?: PrismaClient;\n  pool?: Pool;\n  adapter?: PrismaPg;\n};\n\nconst defaultCaPath =\n  process.env.NODE_EXTRA_CA_CERTS ||\n  path.join(process.cwd(), \"prod-ca-2021.crt\");\nconst sslConfig: { rejectUnauthorized: boolean; ca?: Buffer } = {\n  rejectUnauthorized: true,\n};\nif (fs.existsSync(defaultCaPath)) {\n  sslConfig.ca = fs.readFileSync(defaultCaPath);\n}\n\n// Create a Pool with SSL verification enabled; rely on system trust or NODE_EXTRA_CA_CERTS for Supabase CA.\nconst pool =\n  globalForPrisma.pool ??\n  new Pool({\n    connectionString,\n    ssl: sslConfig,\n  });\nconst adapter = globalForPrisma.adapter ?? new PrismaPg(pool);\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    adapter,\n    log: process.env.NODE_ENV === \"development\" ? [\"warn\", \"error\"] : [\"error\"],\n  });\n\nif (process.env.NODE_ENV !== \"production\") {\n  globalForPrisma.pool = pool;\n  globalForPrisma.adapter = adapter;\n  globalForPrisma.prisma = prisma;\n}\n\nexport default prisma;\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;AAEA,MAAM,mBAAmB,QAAQ,GAAG,CAAC,YAAY;AACjD,IAAI,CAAC,kBAAkB;IACrB,MAAM,IAAI,MAAM;AAClB;AAEA,wEAAwE;AACxE,MAAM,kBAAkB;AAMxB,MAAM,gBACJ,QAAQ,GAAG,CAAC,mBAAmB,IAC/B,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;AAC3B,MAAM,YAA0D;IAC9D,oBAAoB;AACtB;AACA,IAAI,wGAAE,CAAC,UAAU,CAAC,gBAAgB;IAChC,UAAU,EAAE,GAAG,wGAAE,CAAC,YAAY,CAAC;AACjC;AAEA,4GAA4G;AAC5G,MAAM,OACJ,gBAAgB,IAAI,IACpB,IAAI,4GAAI,CAAC;IACP;IACA,KAAK;AACP;AACF,MAAM,UAAU,gBAAgB,OAAO,IAAI,IAAI,yKAAQ,CAAC;AAEjD,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf;IACA,KAAK,uCAAyC;QAAC;QAAQ;KAAQ,GAAG;AACpE;AAEF,wCAA2C;IACzC,gBAAgB,IAAI,GAAG;IACvB,gBAAgB,OAAO,GAAG;IAC1B,gBAAgB,MAAM,GAAG;AAC3B;uCAEe"}},
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///Users/arnoldokoye/hotbat/src/app/api/team-dashboard/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport prisma from \"@/lib/prisma\";\n\ntype TeamDashboardResponse = {\n  teamInfo: {\n    id: number;\n    name: string;\n    abbrev: string;\n    league: string;\n    division: string;\n    logoUrl?: string;\n  };\n  keyMetrics: {\n    id: string;\n    label: string;\n    value: string;\n    comparisonText?: string;\n    trendDirection?: \"up\" | \"down\" | \"flat\";\n  }[];\n  hrTimeSeries: {\n    date: string;\n    hr: number;\n    xHr?: number;\n    avgEv?: number;\n    barrels?: number;\n  }[];\n  pitcherVulnerability: {\n    pitcherName: string;\n    pitcherTeam: string;\n    hrAllowed: number;\n    hrPer9: number;\n    avgEvAllowed?: number;\n    maxDistance?: number;\n  }[];\n  upcomingGames: {\n    gameId: number;\n    date: string;\n    opponentName: string;\n    opponentAbbrev: string;\n    parkName: string;\n    parkHrFactor?: number;\n    predictedHrMean?: number;\n    predictedHrStd?: number;\n    hotbatScore?: number;\n  }[];\n  splits: {\n    overview: { label: string; hrPerGame: number; leagueAvgHrPerGame?: number }[];\n    homeAway: { label: string; hrPerGame: number; leagueAvgHrPerGame?: number }[];\n    lhpRhp: { label: string; hrPerGame: number; leagueAvgHrPerGame?: number }[];\n    monthly: { label: string; hrPerGame: number; leagueAvgHrPerGame?: number }[];\n  };\n  games: {\n    id: number;\n    date: string;\n    opponent: string;\n    park: string;\n    result?: string;\n    hr: number;\n    xHr?: number;\n    hrDiff?: number;\n    opposingSp?: string;\n    opposingSpHr9?: number;\n  }[];\n};\n\nconst parseDate = (value: string | null) => {\n  if (!value) return undefined;\n  const parsed = new Date(value);\n  return Number.isNaN(parsed.getTime()) ? null : parsed;\n};\n\nconst logoPath = (abbrev?: string | null) => {\n  return abbrev\n    ? `/team-logos/${abbrev.toLowerCase()}.svg`\n    : \"/team-logos/default.svg\";\n};\n\nexport async function GET(req: NextRequest) {\n  const { searchParams } = new URL(req.url);\n  const teamIdParam = searchParams.get(\"teamId\");\n  const seasonParam = searchParams.get(\"season\");\n  const splitParam = searchParams.get(\"split\") ?? \"overall\";\n  const fromParam = searchParams.get(\"from\");\n  const toParam = searchParams.get(\"to\");\n\n  const teamId = teamIdParam ? Number(teamIdParam) : Number.NaN;\n  if (!teamIdParam || Number.isNaN(teamId)) {\n    return NextResponse.json(\n      { error: \"teamId query param is required and must be a number\" },\n      { status: 400 },\n    );\n  }\n\n  const season = seasonParam ? Number(seasonParam) : undefined;\n  if (seasonParam && Number.isNaN(season)) {\n    return NextResponse.json(\n      { error: \"season must be a number when provided\" },\n      { status: 400 },\n    );\n  }\n\n  const fromDate = parseDate(fromParam);\n  const toDate = parseDate(toParam);\n  if (fromParam && fromDate === null) {\n    return NextResponse.json(\n      { error: \"from must be a valid date (YYYY-MM-DD)\" },\n      { status: 400 },\n    );\n  }\n  if (toParam && toDate === null) {\n    return NextResponse.json(\n      { error: \"to must be a valid date (YYYY-MM-DD)\" },\n      { status: 400 },\n    );\n  }\n\n  const team = await prisma.team.findUnique({\n    where: { id: teamId },\n    select: {\n      id: true,\n      name: true,\n      abbrev: true,\n      league: true,\n      division: true,\n      logoUrl: true,\n    },\n  });\n  if (!team) {\n    return NextResponse.json({ error: \"Team not found\" }, { status: 404 });\n  }\n\n  const dateFilter =\n    fromDate || toDate\n      ? {\n          date: {\n            ...(fromDate ? { gte: fromDate } : {}),\n            ...(toDate ? { lte: toDate } : {}),\n          },\n        }\n      : {};\n\n  const stats = await prisma.teamGameHrStats.findMany({\n    where: {\n      teamId,\n      ...(season ? { season } : {}),\n      ...dateFilter,\n    },\n    orderBy: { date: \"asc\" },\n    include: {\n      opponentTeam: true,\n      game: {\n        include: { park: true },\n      },\n    },\n  });\n\n  const summaries = await prisma.teamHrSummary.findMany({\n    where: {\n      teamId,\n      ...(season ? { season } : {}),\n    },\n    orderBy: [{ season: \"desc\" }, { updatedAt: \"desc\" }],\n  });\n\n  const summary =\n    summaries.find((s) => s.splitKey === splitParam) ??\n    summaries.find((s) => s.splitKey === \"overall\");\n\n  const keyMetrics = summary\n    ? ([\n        {\n          id: \"hr_per_game\",\n          label: \"HR/Game\",\n          value: summary.hrPerGame.toFixed(2),\n        },\n        {\n          id: \"games_played\",\n          label: \"Games\",\n          value: summary.gamesPlayed.toString(),\n        },\n        {\n          id: \"total_hr\",\n          label: \"Total HR\",\n          value: summary.hr.toString(),\n        },\n        summary.hrVsLeaguePct !== null && summary.hrVsLeaguePct !== undefined\n          ? {\n              id: \"hr_vs_league_pct\",\n              label: \"HR vs League %\",\n              value: `${summary.hrVsLeaguePct.toFixed(1)}%`,\n            }\n          : undefined,\n        summary.avgEv !== null && summary.avgEv !== undefined\n          ? {\n              id: \"avg_ev\",\n              label: \"Avg EV\",\n              value: summary.avgEv.toFixed(1),\n            }\n          : undefined,\n      ] as const).filter(Boolean)\n    : [];\n\n  const hrTimeSeries = stats.map((s) => ({\n    date: s.date.toISOString(),\n    hr: s.hr,\n    xHr: s.xHr ?? undefined,\n    avgEv: s.avgEv ?? undefined,\n    barrels: s.barrels ?? undefined,\n  }));\n\n  const games = stats.map((s) => {\n    const game = s.game;\n    const teamScore =\n      game.homeTeamId === s.teamId ? game.homeScore : game.awayScore;\n    const opponentScore =\n      game.homeTeamId === s.teamId ? game.awayScore : game.homeScore;\n    const result =\n      teamScore !== null &&\n      opponentScore !== null &&\n      teamScore !== undefined &&\n      opponentScore !== undefined\n        ? `${teamScore > opponentScore ? \"W\" : \"L\"} ${teamScore}-${opponentScore}`\n        : undefined;\n    return {\n      id: game.id,\n      date: game.date.toISOString(),\n      opponent: s.opponentTeam?.name ?? \"Unknown\",\n      park: game.park.name,\n      result,\n      hr: s.hr,\n      xHr: s.xHr ?? undefined,\n      hrDiff:\n        s.xHr !== null && s.xHr !== undefined\n          ? Number((s.hr - s.xHr).toFixed(2))\n          : undefined,\n      opposingSp: undefined,\n      opposingSpHr9: undefined,\n    };\n  });\n\n  const splits = {\n    overview:\n      summaries\n        .filter((s) => s.splitKey === \"overall\")\n        .map((s) => ({\n          label: \"Overall HR/G\",\n          hrPerGame: s.hrPerGame,\n        })) ?? [],\n    homeAway: [],\n    lhpRhp: [],\n    monthly: [],\n  };\n\n  const upcoming = await prisma.game.findMany({\n    where: {\n      OR: [{ homeTeamId: teamId }, { awayTeamId: teamId }],\n      status: \"scheduled\",\n      ...(season ? { season } : {}),\n    },\n    orderBy: { date: \"asc\" },\n    include: {\n      homeTeam: true,\n      awayTeam: true,\n      park: {\n        include: {\n          parkHrFactors: {\n            where: season ? { season } : {},\n            orderBy: { updatedAt: \"desc\" },\n            take: 1,\n          },\n        },\n      },\n      gamePredictions: {\n        where: { teamId },\n        orderBy: { predictionTimestamp: \"desc\" },\n        take: 1,\n      },\n    },\n  });\n\n  const upcomingGames = upcoming.map((g) => {\n    const isHome = g.homeTeamId === teamId;\n    const opponent = isHome ? g.awayTeam : g.homeTeam;\n    const prediction = g.gamePredictions[0];\n    const parkFactor =\n      g.park.parkHrFactors[0]?.hrFactor ?? g.park.defaultHrFactor ?? undefined;\n    return {\n      gameId: g.id,\n      date: g.date.toISOString(),\n      opponentName: opponent.name,\n      opponentAbbrev: opponent.abbrev,\n      parkName: g.park.name,\n      parkHrFactor: parkFactor,\n      predictedHrMean: prediction?.predictedHrMean ?? undefined,\n      predictedHrStd: prediction?.predictedHrStd ?? undefined,\n      hotbatScore: prediction?.hotbatScore ?? undefined,\n    };\n  });\n\n  const response: TeamDashboardResponse = {\n    teamInfo: {\n      id: team.id,\n      name: team.name,\n      abbrev: team.abbrev,\n      league: team.league,\n      division: team.division,\n      logoUrl: logoPath(team.abbrev),\n    },\n    keyMetrics,\n    hrTimeSeries,\n    pitcherVulnerability: [],\n    upcomingGames,\n    splits,\n    games,\n  };\n\n  return NextResponse.json(response);\n}\n"],"names":[],"mappings":"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"}}]
}