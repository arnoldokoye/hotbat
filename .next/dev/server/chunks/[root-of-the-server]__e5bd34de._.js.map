{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file:///Users/arnoldokoye/hotbat/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\nimport { PrismaPg } from \"@prisma/adapter-pg\";\nimport { Pool } from \"pg\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nconst connectionString = process.env.DATABASE_URL;\nif (!connectionString) {\n  throw new Error(\"DATABASE_URL is required to initialize Prisma\");\n}\n\n// Ensure a single PrismaClient/Pool instance across hot reloads in dev.\nconst globalForPrisma = globalThis as unknown as {\n  prisma?: PrismaClient;\n  pool?: Pool;\n  adapter?: PrismaPg;\n};\n\nconst defaultCaPath =\n  process.env.NODE_EXTRA_CA_CERTS ||\n  path.join(process.cwd(), \"prod-ca-2021.crt\");\nconst sslConfig: { rejectUnauthorized: boolean; ca?: Buffer } = {\n  rejectUnauthorized: true,\n};\nif (fs.existsSync(defaultCaPath)) {\n  sslConfig.ca = fs.readFileSync(defaultCaPath);\n}\n\n// Create a Pool with SSL verification enabled; rely on system trust or NODE_EXTRA_CA_CERTS for Supabase CA.\nconst pool =\n  globalForPrisma.pool ??\n  new Pool({\n    connectionString,\n    ssl: sslConfig,\n  });\nconst adapter = globalForPrisma.adapter ?? new PrismaPg(pool);\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    adapter,\n    log: process.env.NODE_ENV === \"development\" ? [\"warn\", \"error\"] : [\"error\"],\n  });\n\nif (process.env.NODE_ENV !== \"production\") {\n  globalForPrisma.pool = pool;\n  globalForPrisma.adapter = adapter;\n  globalForPrisma.prisma = prisma;\n}\n\nexport default prisma;\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;AAEA,MAAM,mBAAmB,QAAQ,GAAG,CAAC,YAAY;AACjD,IAAI,CAAC,kBAAkB;IACrB,MAAM,IAAI,MAAM;AAClB;AAEA,wEAAwE;AACxE,MAAM,kBAAkB;AAMxB,MAAM,gBACJ,QAAQ,GAAG,CAAC,mBAAmB,IAC/B,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;AAC3B,MAAM,YAA0D;IAC9D,oBAAoB;AACtB;AACA,IAAI,wGAAE,CAAC,UAAU,CAAC,gBAAgB;IAChC,UAAU,EAAE,GAAG,wGAAE,CAAC,YAAY,CAAC;AACjC;AAEA,4GAA4G;AAC5G,MAAM,OACJ,gBAAgB,IAAI,IACpB,IAAI,4GAAI,CAAC;IACP;IACA,KAAK;AACP;AACF,MAAM,UAAU,gBAAgB,OAAO,IAAI,IAAI,yKAAQ,CAAC;AAEjD,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf;IACA,KAAK,uCAAyC;QAAC;QAAQ;KAAQ,GAAG;AACpE;AAEF,wCAA2C;IACzC,gBAAgB,IAAI,GAAG;IACvB,gBAAgB,OAAO,GAAG;IAC1B,gBAAgB,MAAM,GAAG;AAC3B;uCAEe"}},
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///Users/arnoldokoye/hotbat/src/app/api/today-games/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport prisma from \"@/lib/prisma\";\n\ntype TodayGamesResponse = {\n  date: string;\n  games: {\n    id: number;\n    date: string;\n    startTimeLocal?: string;\n    homeTeamId: number;\n    awayTeamId: number;\n    homeTeamName: string;\n    awayTeamName: string;\n    homeTeamAbbrev: string;\n    awayTeamAbbrev: string;\n    homeTeamLogoUrl?: string;\n    awayTeamLogoUrl?: string;\n    parkName: string;\n    parkHrFactor?: number;\n    homePredictedHrMean?: number;\n    awayPredictedHrMean?: number;\n    hotbatScore?: number;\n    // Additional fields for frontend compatibility\n    homeTeam: string;\n    awayTeam: string;\n    homeProjectedHrMin: number;\n    homeProjectedHrMax: number;\n    awayProjectedHrMin: number;\n    awayProjectedHrMax: number;\n    homeStartingPitcher: {\n      name: string;\n      teamName: string;\n      throws: \"L\" | \"R\";\n      hrPer9: number;\n      era: number;\n    };\n    awayStartingPitcher: {\n      name: string;\n      teamName: string;\n      throws: \"L\" | \"R\";\n      hrPer9: number;\n      era: number;\n    };\n  }[];\n};\n\nconst parseDate = (value: string | null) => {\n  if (!value) return null;\n  const parsed = new Date(`${value}T00:00:00.000Z`);\n  return Number.isNaN(parsed.getTime()) ? null : parsed;\n};\n\nconst logoPath = (abbrev?: string | null) => {\n  return abbrev\n    ? `/team-logos/${abbrev.toLowerCase()}.svg`\n    : \"/team-logos/default.svg\";\n};\n\nexport async function GET(req: NextRequest) {\n  const { searchParams } = new URL(req.url);\n  const dateParam = searchParams.get(\"date\");\n  const date = parseDate(dateParam);\n\n  if (!dateParam || !date) {\n    return NextResponse.json(\n      { error: \"date query param is required (YYYY-MM-DD)\" },\n      { status: 400 },\n    );\n  }\n\n  const endOfDay = new Date(date);\n  endOfDay.setUTCDate(endOfDay.getUTCDate() + 1);\n\n  try {\n    const games = await prisma.game.findMany({\n      where: { date: { gte: date, lt: endOfDay } },\n      orderBy: { date: \"asc\" },\n      include: {\n        homeTeam: true,\n        awayTeam: true,\n        park: {\n          include: {\n            parkHrFactors: {\n              orderBy: { updatedAt: \"desc\" },\n              take: 1,\n            },\n          },\n        },\n        gamePredictions: true,\n      },\n    });\n\n  const getPitcherFromSnapshot = (\n    snapshot: unknown,\n    key: \"home_starting_pitcher\" | \"away_starting_pitcher\",\n  ) => {\n    if (!snapshot || typeof snapshot !== \"object\") return undefined;\n    const obj = snapshot as Record<string, unknown>;\n    const raw = obj[key];\n    if (!raw || typeof raw !== \"object\") return undefined;\n    const pitcher = raw as Record<string, unknown>;\n    const throws = pitcher.throws === \"L\" || pitcher.throws === \"R\" ? pitcher.throws : undefined;\n    const name = typeof pitcher.name === \"string\" ? pitcher.name : undefined;\n    const teamName = typeof pitcher.teamName === \"string\" ? pitcher.teamName : undefined;\n    const hrPer9 = typeof pitcher.hrPer9 === \"number\" ? pitcher.hrPer9 : undefined;\n    const era = typeof pitcher.era === \"number\" ? pitcher.era : undefined;\n    if (!name && !throws && hrPer9 === undefined && era === undefined) return undefined;\n    return { name, teamName, throws, hrPer9, era };\n  };\n\n    const response: TodayGamesResponse = {\n      date: dateParam,\n      games: games.map((game) => {\n        const homePrediction = game.gamePredictions.find(\n          (p) => p.teamId === game.homeTeamId,\n        );\n        const awayPrediction = game.gamePredictions.find(\n          (p) => p.teamId === game.awayTeamId,\n      );\n      const parkFactorEntry = game.park.parkHrFactors[0];\n      const hotbatScore =\n        game.gamePredictions.length > 0\n          ? game.gamePredictions.reduce(\n              (total, prediction) => total + prediction.hotbatScore,\n              0,\n            ) / game.gamePredictions.length\n          : undefined;\n\n      const deriveRange = (mean?: number, std?: number) => {\n        const m = mean ?? 0;\n        const s = std ?? 0;\n        const min = Math.max(0, Number((m - s).toFixed(1)));\n        const max = Math.max(min, Number((m + s).toFixed(1)) || m || 1);\n        return { min, max };\n      };\n\n      const homeRange = deriveRange(\n        homePrediction?.predictedHrMean,\n        homePrediction?.predictedHrStd,\n      );\n      const awayRange = deriveRange(\n        awayPrediction?.predictedHrMean,\n        awayPrediction?.predictedHrStd,\n      );\n\n      const defaultPitcher = {\n        name: \"TBD\",\n        teamName: \"\",\n        throws: \"R\" as const,\n        hrPer9: 0,\n        era: 0,\n      };\n\n      const homePitcherSnapshot = getPitcherFromSnapshot(\n        homePrediction?.featuresSnapshot,\n        \"home_starting_pitcher\",\n      );\n      const awayPitcherSnapshot = getPitcherFromSnapshot(\n        awayPrediction?.featuresSnapshot,\n        \"away_starting_pitcher\",\n      );\n\n      return {\n        id: game.id,\n        date: dateParam,\n        startTimeLocal: game.startTime?.toISOString(),\n        homeTeamId: game.homeTeamId,\n        awayTeamId: game.awayTeamId,\n        homeTeamName: game.homeTeam.name,\n        awayTeamName: game.awayTeam.name,\n        homeTeamAbbrev: game.homeTeam.abbrev,\n        awayTeamAbbrev: game.awayTeam.abbrev,\n        homeTeamLogoUrl: logoPath(game.homeTeam.abbrev),\n        awayTeamLogoUrl: logoPath(game.awayTeam.abbrev),\n        parkName: game.park.name,\n        parkHrFactor:\n          parkFactorEntry?.hrFactor ?? game.park.defaultHrFactor ?? undefined,\n        homePredictedHrMean: homePrediction?.predictedHrMean ?? undefined,\n        awayPredictedHrMean: awayPrediction?.predictedHrMean ?? undefined,\n        hotbatScore,\n        homeTeam: game.homeTeam.name,\n        awayTeam: game.awayTeam.name,\n        homeProjectedHrMin: homeRange.min,\n        homeProjectedHrMax: homeRange.max,\n        awayProjectedHrMin: awayRange.min,\n        awayProjectedHrMax: awayRange.max,\n        homeStartingPitcher: {\n          name: homePitcherSnapshot?.name ?? defaultPitcher.name,\n          teamName: homePitcherSnapshot?.teamName ?? game.homeTeam.name,\n          throws: homePitcherSnapshot?.throws ?? defaultPitcher.throws,\n          hrPer9: homePitcherSnapshot?.hrPer9 ?? defaultPitcher.hrPer9,\n          era: homePitcherSnapshot?.era ?? defaultPitcher.era,\n        },\n        awayStartingPitcher: {\n          name: awayPitcherSnapshot?.name ?? defaultPitcher.name,\n          teamName: awayPitcherSnapshot?.teamName ?? game.awayTeam.name,\n          throws: awayPitcherSnapshot?.throws ?? defaultPitcher.throws,\n          hrPer9: awayPitcherSnapshot?.hrPer9 ?? defaultPitcher.hrPer9,\n          era: awayPitcherSnapshot?.era ?? defaultPitcher.era,\n        },\n      };\n    }),\n  };\n\n  return NextResponse.json(response);\n  } catch (error) {\n    console.error(\"today-games handler error\", error);\n    const fallback: TodayGamesResponse = { date: dateParam, games: [] };\n    return NextResponse.json(fallback, { status: 200 });\n  }\n}\n"],"names":[],"mappings":"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"}}]
}