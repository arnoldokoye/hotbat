module.exports = [
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/shared/lib/no-fallback-error.external.js [external] (next/dist/shared/lib/no-fallback-error.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/shared/lib/no-fallback-error.external.js", () => require("next/dist/shared/lib/no-fallback-error.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/@prisma/client [external] (@prisma/client, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("@prisma/client", () => require("@prisma/client"));

module.exports = mod;
}),
"[externals]/pg [external] (pg, esm_import)", ((__turbopack_context__) => {
"use strict";

return __turbopack_context__.a(async (__turbopack_handle_async_dependencies__, __turbopack_async_result__) => { try {

const mod = await __turbopack_context__.y("pg");

__turbopack_context__.n(mod);
__turbopack_async_result__();
} catch(e) { __turbopack_async_result__(e); } }, true);}),
"[externals]/fs [external] (fs, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("fs", () => require("fs"));

module.exports = mod;
}),
"[externals]/path [external] (path, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("path", () => require("path"));

module.exports = mod;
}),
"[project]/src/lib/prisma.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

return __turbopack_context__.a(async (__turbopack_handle_async_dependencies__, __turbopack_async_result__) => { try {

__turbopack_context__.s([
    "default",
    ()=>__TURBOPACK__default__export__,
    "prisma",
    ()=>prisma
]);
var __TURBOPACK__imported__module__$5b$externals$5d2f40$prisma$2f$client__$5b$external$5d$__$2840$prisma$2f$client$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/@prisma/client [external] (@prisma/client, cjs)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$prisma$2f$adapter$2d$pg$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@prisma/adapter-pg/dist/index.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$pg__$5b$external$5d$__$28$pg$2c$__esm_import$29$__ = __turbopack_context__.i("[externals]/pg [external] (pg, esm_import)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$fs__$5b$external$5d$__$28$fs$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/fs [external] (fs, cjs)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$path__$5b$external$5d$__$28$path$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/path [external] (path, cjs)");
var __turbopack_async_dependencies__ = __turbopack_handle_async_dependencies__([
    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$prisma$2f$adapter$2d$pg$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__,
    __TURBOPACK__imported__module__$5b$externals$5d2f$pg__$5b$external$5d$__$28$pg$2c$__esm_import$29$__
]);
[__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$prisma$2f$adapter$2d$pg$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__, __TURBOPACK__imported__module__$5b$externals$5d2f$pg__$5b$external$5d$__$28$pg$2c$__esm_import$29$__] = __turbopack_async_dependencies__.then ? (await __turbopack_async_dependencies__)() : __turbopack_async_dependencies__;
;
;
;
;
;
const connectionString = process.env.DATABASE_URL;
if (!connectionString) {
    throw new Error("DATABASE_URL is required to initialize Prisma");
}
// Ensure a single PrismaClient/Pool instance across hot reloads in dev.
const globalForPrisma = globalThis;
const defaultCaPath = process.env.NODE_EXTRA_CA_CERTS || __TURBOPACK__imported__module__$5b$externals$5d2f$path__$5b$external$5d$__$28$path$2c$__cjs$29$__["default"].join(process.cwd(), "prod-ca-2021.crt");
const sslConfig = {
    rejectUnauthorized: true
};
if (__TURBOPACK__imported__module__$5b$externals$5d2f$fs__$5b$external$5d$__$28$fs$2c$__cjs$29$__["default"].existsSync(defaultCaPath)) {
    sslConfig.ca = __TURBOPACK__imported__module__$5b$externals$5d2f$fs__$5b$external$5d$__$28$fs$2c$__cjs$29$__["default"].readFileSync(defaultCaPath);
}
// Create a Pool with SSL verification enabled; rely on system trust or NODE_EXTRA_CA_CERTS for Supabase CA.
const pool = globalForPrisma.pool ?? new __TURBOPACK__imported__module__$5b$externals$5d2f$pg__$5b$external$5d$__$28$pg$2c$__esm_import$29$__["Pool"]({
    connectionString,
    ssl: sslConfig
});
const adapter = globalForPrisma.adapter ?? new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$prisma$2f$adapter$2d$pg$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["PrismaPg"](pool);
const prisma = globalForPrisma.prisma ?? new __TURBOPACK__imported__module__$5b$externals$5d2f40$prisma$2f$client__$5b$external$5d$__$2840$prisma$2f$client$2c$__cjs$29$__["PrismaClient"]({
    adapter,
    log: ("TURBOPACK compile-time truthy", 1) ? [
        "warn",
        "error"
    ] : "TURBOPACK unreachable"
});
if ("TURBOPACK compile-time truthy", 1) {
    globalForPrisma.pool = pool;
    globalForPrisma.adapter = adapter;
    globalForPrisma.prisma = prisma;
}
const __TURBOPACK__default__export__ = prisma;
__turbopack_async_result__();
} catch(e) { __turbopack_async_result__(e); } }, false);}),
"[project]/src/app/api/today-games/route.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

return __turbopack_context__.a(async (__turbopack_handle_async_dependencies__, __turbopack_async_result__) => { try {

__turbopack_context__.s([
    "GET",
    ()=>GET
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/prisma.ts [app-route] (ecmascript)");
var __turbopack_async_dependencies__ = __turbopack_handle_async_dependencies__([
    __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__
]);
[__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__] = __turbopack_async_dependencies__.then ? (await __turbopack_async_dependencies__)() : __turbopack_async_dependencies__;
;
;
const parseDate = (value)=>{
    if (!value) return null;
    const parsed = new Date(`${value}T00:00:00.000Z`);
    return Number.isNaN(parsed.getTime()) ? null : parsed;
};
const logoPath = (abbrev)=>{
    return abbrev ? `/team-logos/${abbrev.toLowerCase()}.svg` : "/team-logos/default.svg";
};
async function GET(req) {
    const { searchParams } = new URL(req.url);
    const dateParam = searchParams.get("date");
    const date = parseDate(dateParam);
    if (!dateParam || !date) {
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: "date query param is required (YYYY-MM-DD)"
        }, {
            status: 400
        });
    }
    const endOfDay = new Date(date);
    endOfDay.setUTCDate(endOfDay.getUTCDate() + 1);
    try {
        const games = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$prisma$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].game.findMany({
            where: {
                date: {
                    gte: date,
                    lt: endOfDay
                }
            },
            orderBy: {
                date: "asc"
            },
            include: {
                homeTeam: true,
                awayTeam: true,
                park: {
                    include: {
                        parkHrFactors: {
                            orderBy: {
                                updatedAt: "desc"
                            },
                            take: 1
                        }
                    }
                },
                gamePredictions: true
            }
        });
        const getPitcherFromSnapshot = (snapshot, key)=>{
            if (!snapshot || typeof snapshot !== "object") return undefined;
            const obj = snapshot;
            const raw = obj[key];
            if (!raw || typeof raw !== "object") return undefined;
            const pitcher = raw;
            const throws = pitcher.throws === "L" || pitcher.throws === "R" ? pitcher.throws : undefined;
            const name = typeof pitcher.name === "string" ? pitcher.name : undefined;
            const teamName = typeof pitcher.teamName === "string" ? pitcher.teamName : undefined;
            const hrPer9 = typeof pitcher.hrPer9 === "number" ? pitcher.hrPer9 : undefined;
            const era = typeof pitcher.era === "number" ? pitcher.era : undefined;
            if (!name && !throws && hrPer9 === undefined && era === undefined) return undefined;
            return {
                name,
                teamName,
                throws,
                hrPer9,
                era
            };
        };
        const response = {
            date: dateParam,
            games: games.map((game)=>{
                const homePrediction = game.gamePredictions.find((p)=>p.teamId === game.homeTeamId);
                const awayPrediction = game.gamePredictions.find((p)=>p.teamId === game.awayTeamId);
                const parkFactorEntry = game.park.parkHrFactors[0];
                const hotbatScore = game.gamePredictions.length > 0 ? game.gamePredictions.reduce((total, prediction)=>total + prediction.hotbatScore, 0) / game.gamePredictions.length : undefined;
                const deriveRange = (mean, std)=>{
                    const m = mean ?? 0;
                    const s = std ?? 0;
                    const min = Math.max(0, Number((m - s).toFixed(1)));
                    const max = Math.max(min, Number((m + s).toFixed(1)) || m || 1);
                    return {
                        min,
                        max
                    };
                };
                const homeRange = deriveRange(homePrediction?.predictedHrMean, homePrediction?.predictedHrStd);
                const awayRange = deriveRange(awayPrediction?.predictedHrMean, awayPrediction?.predictedHrStd);
                const defaultPitcher = {
                    name: "TBD",
                    teamName: "",
                    throws: "R",
                    hrPer9: 0,
                    era: 0
                };
                const homePitcherSnapshot = getPitcherFromSnapshot(homePrediction?.featuresSnapshot, "home_starting_pitcher");
                const awayPitcherSnapshot = getPitcherFromSnapshot(awayPrediction?.featuresSnapshot, "away_starting_pitcher");
                return {
                    id: game.id,
                    date: dateParam,
                    startTimeLocal: game.startTime?.toISOString(),
                    homeTeamId: game.homeTeamId,
                    awayTeamId: game.awayTeamId,
                    homeTeamName: game.homeTeam.name,
                    awayTeamName: game.awayTeam.name,
                    homeTeamAbbrev: game.homeTeam.abbrev,
                    awayTeamAbbrev: game.awayTeam.abbrev,
                    homeTeamLogoUrl: logoPath(game.homeTeam.abbrev),
                    awayTeamLogoUrl: logoPath(game.awayTeam.abbrev),
                    parkName: game.park.name,
                    parkHrFactor: parkFactorEntry?.hrFactor ?? game.park.defaultHrFactor ?? undefined,
                    homePredictedHrMean: homePrediction?.predictedHrMean ?? undefined,
                    awayPredictedHrMean: awayPrediction?.predictedHrMean ?? undefined,
                    hotbatScore,
                    homeTeam: game.homeTeam.name,
                    awayTeam: game.awayTeam.name,
                    homeProjectedHrMin: homeRange.min,
                    homeProjectedHrMax: homeRange.max,
                    awayProjectedHrMin: awayRange.min,
                    awayProjectedHrMax: awayRange.max,
                    homeStartingPitcher: {
                        name: homePitcherSnapshot?.name ?? defaultPitcher.name,
                        teamName: homePitcherSnapshot?.teamName ?? game.homeTeam.name,
                        throws: homePitcherSnapshot?.throws ?? defaultPitcher.throws,
                        hrPer9: homePitcherSnapshot?.hrPer9 ?? defaultPitcher.hrPer9,
                        era: homePitcherSnapshot?.era ?? defaultPitcher.era
                    },
                    awayStartingPitcher: {
                        name: awayPitcherSnapshot?.name ?? defaultPitcher.name,
                        teamName: awayPitcherSnapshot?.teamName ?? game.awayTeam.name,
                        throws: awayPitcherSnapshot?.throws ?? defaultPitcher.throws,
                        hrPer9: awayPitcherSnapshot?.hrPer9 ?? defaultPitcher.hrPer9,
                        era: awayPitcherSnapshot?.era ?? defaultPitcher.era
                    }
                };
            })
        };
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json(response);
    } catch (error) {
        console.error("today-games handler error", error);
        const fallback = {
            date: dateParam,
            games: []
        };
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json(fallback, {
            status: 200
        });
    }
}
__turbopack_async_result__();
} catch(e) { __turbopack_async_result__(e); } }, false);}),
];

//# sourceMappingURL=%5Broot-of-the-server%5D__e5bd34de._.js.map