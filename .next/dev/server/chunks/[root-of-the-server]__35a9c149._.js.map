{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 88, "column": 0}, "map": {"version":3,"sources":["file:///Users/arnoldokoye/hotbat/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\nimport { PrismaPg } from \"@prisma/adapter-pg\";\nimport { Pool } from \"pg\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nconst connectionString = process.env.DATABASE_URL;\nif (!connectionString) {\n  throw new Error(\"DATABASE_URL is required to initialize Prisma\");\n}\n\n// Ensure a single PrismaClient/Pool instance across hot reloads in dev.\nconst globalForPrisma = globalThis as unknown as {\n  prisma?: PrismaClient;\n  pool?: Pool;\n  adapter?: PrismaPg;\n  __dbUsedInsecureSsl?: boolean;\n};\n\nconst defaultCaPath =\n  process.env.NODE_EXTRA_CA_CERTS ||\n  path.join(process.cwd(), \"prod-ca-2021.crt\");\nconst caFileExists = defaultCaPath ? fs.existsSync(defaultCaPath) : false;\nconst caBuffer = caFileExists ? fs.readFileSync(defaultCaPath) : undefined;\nconst allowInsecureEnv =\n  process.env.DB_SSL_ALLOW_INSECURE === \"1\" ||\n  process.env.DB_SSL_ALLOW_INSECURE === \"true\" ||\n  process.env.NODE_TLS_REJECT_UNAUTHORIZED === \"0\";\nconst connectionTimeoutMs =\n  Number.parseInt(process.env.DB_CONNECTION_TIMEOUT_MS ?? \"\", 10) || 5000;\n\ntype PoolInit = {\n  pool: Pool;\n  usedInsecure: boolean;\n};\n\nconst buildPool = (rejectUnauthorized: boolean): PoolInit => {\n  const ssl: { rejectUnauthorized: boolean; ca?: Buffer } = { rejectUnauthorized };\n  if (caBuffer) {\n    ssl.ca = caBuffer;\n  }\n  return {\n    pool: new Pool({\n      connectionString,\n      ssl,\n      connectionTimeoutMillis: connectionTimeoutMs,\n    }),\n    usedInsecure: !rejectUnauthorized,\n  };\n};\n\nconst isTlsError = (error: unknown) => {\n  if (!error || typeof error !== \"object\") return false;\n  const code = (error as { code?: string }).code ?? \"\";\n  const message = (error as { message?: string }).message ?? \"\";\n  const tlsCodes = [\n    \"SELF_SIGNED_CERT_IN_CHAIN\",\n    \"DEPTH_ZERO_SELF_SIGNED_CERT\",\n    \"UNABLE_TO_VERIFY_LEAF_SIGNATURE\",\n    \"ERR_TLS_CERT_ALTNAME_INVALID\",\n    \"UNABLE_TO_GET_ISSUER_CERT_LOCALLY\",\n  ];\n  return tlsCodes.includes(code) || message.toLowerCase().includes(\"certificate\");\n};\n\nconst initPool = async (): Promise<PoolInit> => {\n  const primary = buildPool(!allowInsecureEnv);\n\n  const warmupResult = await primary.pool\n    .query(\"SELECT 1\")\n    .then(() => \"ok\" as const)\n    .catch((error) => {\n      if (!allowInsecureEnv && isTlsError(error)) {\n        return \"tls-error\" as const;\n      }\n      console.warn(\n        \"Database warm-up query failed; continuing with current SSL config.\",\n        error,\n      );\n      return \"failed\" as const;\n    });\n\n  if (warmupResult === \"tls-error\") {\n    await primary.pool.end().catch(() => {});\n    console.warn(\n      \"Database TLS verification failed; retrying with rejectUnauthorized=false. \" +\n        \"Provide NODE_EXTRA_CA_CERTS with your trusted root to restore verification.\",\n    );\n    return buildPool(false);\n  }\n\n  return primary;\n};\n\nconst { pool, usedInsecure } =\n  globalForPrisma.pool && typeof globalForPrisma.__dbUsedInsecureSsl === \"boolean\"\n    ? { pool: globalForPrisma.pool, usedInsecure: globalForPrisma.__dbUsedInsecureSsl }\n    : await initPool();\n\nconst adapter = globalForPrisma.adapter ?? new PrismaPg(pool);\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    adapter,\n    log: process.env.NODE_ENV === \"development\" ? [\"warn\", \"error\"] : [\"error\"],\n  });\n\nif (process.env.NODE_ENV !== \"production\") {\n  globalForPrisma.pool = pool;\n  globalForPrisma.adapter = adapter;\n  globalForPrisma.prisma = prisma;\n  globalForPrisma.__dbUsedInsecureSsl = usedInsecure;\n}\n\nexport default prisma;\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;AAEA,MAAM,mBAAmB,QAAQ,GAAG,CAAC,YAAY;AACjD,IAAI,CAAC,kBAAkB;IACrB,MAAM,IAAI,MAAM;AAClB;AAEA,wEAAwE;AACxE,MAAM,kBAAkB;AAOxB,MAAM,gBACJ,QAAQ,GAAG,CAAC,mBAAmB,IAC/B,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;AAC3B,MAAM,eAAe,uCAAgB,wGAAE,CAAC,UAAU,CAAC,iBAAiB;AACpE,MAAM,WAAW,eAAe,wGAAE,CAAC,YAAY,CAAC,iBAAiB;AACjE,MAAM,mBACJ,QAAQ,GAAG,CAAC,qBAAqB,KAAK,OACtC,QAAQ,GAAG,CAAC,qBAAqB,KAAK,UACtC,QAAQ,GAAG,CAAC,4BAA4B,KAAK;AAC/C,MAAM,sBACJ,OAAO,QAAQ,CAAC,QAAQ,GAAG,CAAC,wBAAwB,IAAI,IAAI,OAAO;AAOrE,MAAM,YAAY,CAAC;IACjB,MAAM,MAAoD;QAAE;IAAmB;IAC/E,IAAI,UAAU;QACZ,IAAI,EAAE,GAAG;IACX;IACA,OAAO;QACL,MAAM,IAAI,4GAAI,CAAC;YACb;YACA;YACA,yBAAyB;QAC3B;QACA,cAAc,CAAC;IACjB;AACF;AAEA,MAAM,aAAa,CAAC;IAClB,IAAI,CAAC,SAAS,OAAO,UAAU,UAAU,OAAO;IAChD,MAAM,OAAO,AAAC,MAA4B,IAAI,IAAI;IAClD,MAAM,UAAU,AAAC,MAA+B,OAAO,IAAI;IAC3D,MAAM,WAAW;QACf;QACA;QACA;QACA;QACA;KACD;IACD,OAAO,SAAS,QAAQ,CAAC,SAAS,QAAQ,WAAW,GAAG,QAAQ,CAAC;AACnE;AAEA,MAAM,WAAW;IACf,MAAM,UAAU,UAAU,CAAC;IAE3B,MAAM,eAAe,MAAM,QAAQ,IAAI,CACpC,KAAK,CAAC,YACN,IAAI,CAAC,IAAM,MACX,KAAK,CAAC,CAAC;QACN,IAAI,CAAC,oBAAoB,WAAW,QAAQ;YAC1C,OAAO;QACT;QACA,QAAQ,IAAI,CACV,sEACA;QAEF,OAAO;IACT;IAEF,IAAI,iBAAiB,aAAa;QAChC,MAAM,QAAQ,IAAI,CAAC,GAAG,GAAG,KAAK,CAAC,KAAO;QACtC,QAAQ,IAAI,CACV,+EACE;QAEJ,OAAO,UAAU;IACnB;IAEA,OAAO;AACT;AAEA,MAAM,EAAE,IAAI,EAAE,YAAY,EAAE,GAC1B,gBAAgB,IAAI,IAAI,OAAO,gBAAgB,mBAAmB,KAAK,YACnE;IAAE,MAAM,gBAAgB,IAAI;IAAE,cAAc,gBAAgB,mBAAmB;AAAC,IAChF,MAAM;AAEZ,MAAM,UAAU,gBAAgB,OAAO,IAAI,IAAI,yKAAQ,CAAC;AAEjD,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf;IACA,KAAK,uCAAyC;QAAC;QAAQ;KAAQ,GAAG;AACpE;AAEF,wCAA2C;IACzC,gBAAgB,IAAI,GAAG;IACvB,gBAAgB,OAAO,GAAG;IAC1B,gBAAgB,MAAM,GAAG;IACzB,gBAAgB,mBAAmB,GAAG;AACxC;uCAEe"}},
    {"offset": {"line": 189, "column": 0}, "map": {"version":3,"sources":["file:///Users/arnoldokoye/hotbat/src/lib/csv/ballparks.ts"],"sourcesContent":["import fs from \"node:fs/promises\";\nimport path from \"node:path\";\n\nconst GAMELOGS_DIR = path.join(process.cwd(), \"data_sources\", \"NEW_DATA_SETS\", \"2020-25 GAMELOGS\");\nconst BALLPARKS_CSV_PATH = path.join(GAMELOGS_DIR, \"ballparks.csv\");\n\nlet cache: { mtimeMs: number; byParkId: Map<string, string> } | null = null;\n\nfunction splitCsvLine(line: string): string[] {\n  const out: string[] = [];\n  let cur = \"\";\n  let inQuotes = false;\n\n  for (let i = 0; i < line.length; i += 1) {\n    const ch = line[i];\n\n    if (ch === '\"') {\n      if (inQuotes && line[i + 1] === '\"') {\n        cur += '\"';\n        i += 1;\n        continue;\n      }\n      inQuotes = !inQuotes;\n      continue;\n    }\n\n    if (ch === \",\" && !inQuotes) {\n      out.push(cur);\n      cur = \"\";\n      continue;\n    }\n\n    cur += ch;\n  }\n\n  out.push(cur);\n  return out;\n}\n\nexport async function loadBallparks(): Promise<Map<string, string>> {\n  const stat = await fs.stat(BALLPARKS_CSV_PATH);\n  if (cache && cache.mtimeMs === stat.mtimeMs) return cache.byParkId;\n\n  const csvText = await fs.readFile(BALLPARKS_CSV_PATH, \"utf8\");\n  const text = csvText.replace(/^\\uFEFF/, \"\").trim();\n  const lines = text.split(/\\r?\\n/).filter(Boolean);\n  if (lines.length < 2) throw new Error(`ballparks.csv is empty: ${BALLPARKS_CSV_PATH}`);\n\n  const header = splitCsvLine(lines[0]).map((h) => h.trim().toUpperCase());\n  const idx = new Map(header.map((h, i) => [h, i]));\n\n  function cell(cols: string[], key: string): string {\n    const i = idx.get(key);\n    return i === undefined ? \"\" : (cols[i] ?? \"\").trim();\n  }\n\n  const byParkId = new Map<string, string>();\n  for (const line of lines.slice(1)) {\n    const cols = splitCsvLine(line);\n    const parkId = cell(cols, \"PARKID\");\n    const name = cell(cols, \"NAME\");\n    if (!parkId || !name) continue;\n    if (!byParkId.has(parkId)) byParkId.set(parkId, name);\n  }\n\n  cache = { mtimeMs: stat.mtimeMs, byParkId };\n  return byParkId;\n}\n\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,eAAe,4HAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,gBAAgB,iBAAiB;AAC/E,MAAM,qBAAqB,4HAAI,CAAC,IAAI,CAAC,cAAc;AAEnD,IAAI,QAAmE;AAEvE,SAAS,aAAa,IAAY;IAChC,MAAM,MAAgB,EAAE;IACxB,IAAI,MAAM;IACV,IAAI,WAAW;IAEf,IAAK,IAAI,IAAI,GAAG,IAAI,KAAK,MAAM,EAAE,KAAK,EAAG;QACvC,MAAM,KAAK,IAAI,CAAC,EAAE;QAElB,IAAI,OAAO,KAAK;YACd,IAAI,YAAY,IAAI,CAAC,IAAI,EAAE,KAAK,KAAK;gBACnC,OAAO;gBACP,KAAK;gBACL;YACF;YACA,WAAW,CAAC;YACZ;QACF;QAEA,IAAI,OAAO,OAAO,CAAC,UAAU;YAC3B,IAAI,IAAI,CAAC;YACT,MAAM;YACN;QACF;QAEA,OAAO;IACT;IAEA,IAAI,IAAI,CAAC;IACT,OAAO;AACT;AAEO,eAAe;IACpB,MAAM,OAAO,MAAM,gJAAE,CAAC,IAAI,CAAC;IAC3B,IAAI,SAAS,MAAM,OAAO,KAAK,KAAK,OAAO,EAAE,OAAO,MAAM,QAAQ;IAElE,MAAM,UAAU,MAAM,gJAAE,CAAC,QAAQ,CAAC,oBAAoB;IACtD,MAAM,OAAO,QAAQ,OAAO,CAAC,WAAW,IAAI,IAAI;IAChD,MAAM,QAAQ,KAAK,KAAK,CAAC,SAAS,MAAM,CAAC;IACzC,IAAI,MAAM,MAAM,GAAG,GAAG,MAAM,IAAI,MAAM,CAAC,wBAAwB,EAAE,oBAAoB;IAErF,MAAM,SAAS,aAAa,KAAK,CAAC,EAAE,EAAE,GAAG,CAAC,CAAC,IAAM,EAAE,IAAI,GAAG,WAAW;IACrE,MAAM,MAAM,IAAI,IAAI,OAAO,GAAG,CAAC,CAAC,GAAG,IAAM;YAAC;YAAG;SAAE;IAE/C,SAAS,KAAK,IAAc,EAAE,GAAW;QACvC,MAAM,IAAI,IAAI,GAAG,CAAC;QAClB,OAAO,MAAM,YAAY,KAAK,CAAC,IAAI,CAAC,EAAE,IAAI,EAAE,EAAE,IAAI;IACpD;IAEA,MAAM,WAAW,IAAI;IACrB,KAAK,MAAM,QAAQ,MAAM,KAAK,CAAC,GAAI;QACjC,MAAM,OAAO,aAAa;QAC1B,MAAM,SAAS,KAAK,MAAM;QAC1B,MAAM,OAAO,KAAK,MAAM;QACxB,IAAI,CAAC,UAAU,CAAC,MAAM;QACtB,IAAI,CAAC,SAAS,GAAG,CAAC,SAAS,SAAS,GAAG,CAAC,QAAQ;IAClD;IAEA,QAAQ;QAAE,SAAS,KAAK,OAAO;QAAE;IAAS;IAC1C,OAAO;AACT"}},
    {"offset": {"line": 259, "column": 0}, "map": {"version":3,"sources":["file:///Users/arnoldokoye/hotbat/src/lib/csv/teams.ts"],"sourcesContent":["import fs from \"node:fs/promises\";\nimport path from \"node:path\";\n\nimport type { TeamSummary } from \"@/lib/backend/DataBackend\";\n\nconst GAMELOGS_DIR = path.join(process.cwd(), \"data_sources\", \"NEW_DATA_SETS\", \"2020-25 GAMELOGS\");\nconst TEAMS_CSV_PATH = path.join(GAMELOGS_DIR, \"teams.csv\");\n\nlet cache:\n  | {\n      mtimeMs: number;\n      teams: TeamSummary[];\n    }\n  | null = null;\n\nfunction splitCsvLine(line: string): string[] {\n  const out: string[] = [];\n  let cur = \"\";\n  let inQuotes = false;\n\n  for (let i = 0; i < line.length; i += 1) {\n    const ch = line[i];\n\n    if (ch === '\"') {\n      if (inQuotes && line[i + 1] === '\"') {\n        cur += '\"';\n        i += 1;\n        continue;\n      }\n      inQuotes = !inQuotes;\n      continue;\n    }\n\n    if (ch === \",\" && !inQuotes) {\n      out.push(cur);\n      cur = \"\";\n      continue;\n    }\n\n    cur += ch;\n  }\n\n  out.push(cur);\n  return out;\n}\n\nfunction parseIntSafe(value: string): number | null {\n  const v = value.trim();\n  if (!v) return null;\n  const n = Number.parseInt(v, 10);\n  return Number.isFinite(n) ? n : null;\n}\n\nexport async function loadTeams(options?: {\n  minSeason?: number;\n  maxSeason?: number;\n  leagues?: string[];\n}): Promise<TeamSummary[]> {\n  const stat = await fs.stat(TEAMS_CSV_PATH);\n  if (cache && cache.mtimeMs === stat.mtimeMs) return cache.teams;\n\n  const csvText = await fs.readFile(TEAMS_CSV_PATH, \"utf8\");\n  const text = csvText.replace(/^\\uFEFF/, \"\").trim();\n  if (!text) {\n    cache = { mtimeMs: stat.mtimeMs, teams: [] };\n    return [];\n  }\n\n  const lines = text.split(/\\r?\\n/).filter(Boolean);\n  if (lines.length < 2) {\n    cache = { mtimeMs: stat.mtimeMs, teams: [] };\n    return [];\n  }\n\n  const header = splitCsvLine(lines[0]).map((h) => h.trim().toUpperCase());\n  const idx = new Map(header.map((h, i) => [h, i]));\n\n  function cell(cols: string[], key: string): string {\n    const i = idx.get(key);\n    return i === undefined ? \"\" : (cols[i] ?? \"\").trim();\n  }\n\n  const minSeason = options?.minSeason ?? 2020;\n  const maxSeason = options?.maxSeason ?? 2025;\n  const leagues =\n    options?.leagues?.map((l) => l.trim().toUpperCase()).filter(Boolean) ?? [\"AL\", \"NL\"];\n\n  type Candidate = { first: number; last: number; league: string | null; name: string };\n  const bestByTeam = new Map<string, Candidate>();\n\n  for (const line of lines.slice(1)) {\n    const cols = splitCsvLine(line);\n    const team_id = cell(cols, \"TEAM\");\n    const league = cell(cols, \"LEAGUE\").toUpperCase();\n    const city = cell(cols, \"CITY\");\n    const nickname = cell(cols, \"NICKNAME\");\n    const first = parseIntSafe(cell(cols, \"FIRST\")) ?? 0;\n    const last = parseIntSafe(cell(cols, \"LAST\")) ?? 9999;\n    if (!team_id || !city || !nickname) continue;\n    if (leagues.length && league && !leagues.includes(league)) continue;\n    if (last < minSeason || first > maxSeason) continue;\n\n    const name = `${city} ${nickname}`;\n    const cand: Candidate = { first, last, league: league || null, name };\n    const existing = bestByTeam.get(team_id);\n    if (!existing) {\n      bestByTeam.set(team_id, cand);\n      continue;\n    }\n    // Prefer the most recent era (highest FIRST), then lexicographic name for determinism.\n    if (cand.first > existing.first) {\n      bestByTeam.set(team_id, cand);\n    } else if (cand.first === existing.first && cand.name < existing.name) {\n      bestByTeam.set(team_id, cand);\n    }\n  }\n\n  const teams: TeamSummary[] = Array.from(bestByTeam.entries()).map(([team_id, cand]) => ({\n    team_id,\n    team_name: cand.name,\n    league: cand.league,\n  }));\n\n  teams.sort((a, b) => {\n    if (a.team_name !== b.team_name) return a.team_name.localeCompare(b.team_name);\n    return a.team_id.localeCompare(b.team_id);\n  });\n\n  cache = { mtimeMs: stat.mtimeMs, teams };\n  return teams;\n}\n\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 386, "column": 0}, "map": {"version":3,"sources":["file:///Users/arnoldokoye/hotbat/src/lib/csv/playerRegistry.ts"],"sourcesContent":["import fs from \"node:fs/promises\";\nimport path from \"node:path\";\n\nimport type { Handedness, PlayerSummary, ThrowHand } from \"@/lib/backend/DataBackend\";\n\nconst PLAYER_REGISTRY_CSV_PATH = path.join(process.cwd(), \"scripts\", \"ml\", \"data\", \"player_registry.csv\");\nconst BIOFILE_CSV_PATH = path.join(\n  process.cwd(),\n  \"data_sources\",\n  \"NEW_DATA_SETS\",\n  \"2020-25 GAMELOGS\",\n  \"biofile (1)\",\n  \"biofile.csv\",\n);\n\ntype PlayerRegistryRow = {\n  player_id: string;\n  player_name: string;\n  first_name: string;\n  last_name: string;\n};\n\nlet cache:\n  | {\n      registryMtimeMs: number;\n      bioMtimeMs: number | null;\n      players: PlayerSummary[];\n    }\n  | null = null;\n\nfunction splitCsvLine(line: string): string[] {\n  const out: string[] = [];\n  let cur = \"\";\n  let inQuotes = false;\n\n  for (let i = 0; i < line.length; i += 1) {\n    const ch = line[i];\n\n    if (ch === '\"') {\n      if (inQuotes && line[i + 1] === '\"') {\n        cur += '\"';\n        i += 1;\n        continue;\n      }\n      inQuotes = !inQuotes;\n      continue;\n    }\n\n    if (ch === \",\" && !inQuotes) {\n      out.push(cur);\n      cur = \"\";\n      continue;\n    }\n\n    cur += ch;\n  }\n\n  out.push(cur);\n  return out;\n}\n\nfunction normalizeBats(value: string): Handedness | null {\n  const v = value.trim().toUpperCase();\n  if (v === \"L\" || v === \"R\" || v === \"B\") return v;\n  return null;\n}\n\nfunction normalizeThrows(value: string): ThrowHand | null {\n  const v = value.trim().toUpperCase();\n  if (v === \"L\" || v === \"R\") return v;\n  return null;\n}\n\nfunction parseYearFromMmDdYyyy(value: string): number | null {\n  const v = value.trim();\n  const m = /^\\d{2}\\/\\d{2}\\/(\\d{4})$/.exec(v);\n  if (!m) return null;\n  const year = Number.parseInt(m[1], 10);\n  return Number.isFinite(year) ? year : null;\n}\n\nasync function loadPlayerRegistryRows(): Promise<PlayerRegistryRow[]> {\n  const csvText = await fs.readFile(PLAYER_REGISTRY_CSV_PATH, \"utf8\");\n  const text = csvText.replace(/^\\uFEFF/, \"\").trim();\n  if (!text) return [];\n  const lines = text.split(/\\r?\\n/).filter(Boolean);\n  if (lines.length < 2) return [];\n\n  const header = splitCsvLine(lines[0]).map((h) => h.trim());\n  const idx = new Map(header.map((h, i) => [h, i]));\n\n  const idIdx = idx.get(\"player_id\");\n  const firstIdx = idx.get(\"first_name\");\n  const lastIdx = idx.get(\"last_name\");\n  const nameIdx = idx.get(\"full_name\");\n  if (idIdx === undefined || nameIdx === undefined || firstIdx === undefined || lastIdx === undefined) {\n    return [];\n  }\n\n  const rows: PlayerRegistryRow[] = [];\n  for (const line of lines.slice(1)) {\n    const cols = splitCsvLine(line);\n    const player_id = (cols[idIdx] ?? \"\").trim();\n    const first_name = (cols[firstIdx] ?? \"\").trim();\n    const last_name = (cols[lastIdx] ?? \"\").trim();\n    const player_name = (cols[nameIdx] ?? \"\").trim();\n    if (!player_id || !player_name || !first_name || !last_name) continue;\n    rows.push({ player_id, player_name, first_name, last_name });\n  }\n  return rows;\n}\n\nasync function loadBioHands(): Promise<\n  Map<\n    string,\n    {\n      bats: Handedness | null;\n      throws: ThrowHand | null;\n      first_season: number | null;\n      last_season: number | null;\n    }\n  >\n> {\n  const byId = new Map<\n    string,\n    {\n      bats: Handedness | null;\n      throws: ThrowHand | null;\n      first_season: number | null;\n      last_season: number | null;\n    }\n  >();\n\n  const csvText = await fs.readFile(BIOFILE_CSV_PATH, \"utf8\");\n  const text = csvText.replace(/^\\uFEFF/, \"\").trim();\n  if (!text) return byId;\n\n  const lines = text.split(/\\r?\\n/).filter(Boolean);\n  if (lines.length < 2) return byId;\n\n  const header = splitCsvLine(lines[0]).map((h) => h.trim().toUpperCase());\n  const idx = new Map(header.map((h, i) => [h, i]));\n\n  function cell(cols: string[], key: string): string {\n    const i = idx.get(key);\n    return i === undefined ? \"\" : (cols[i] ?? \"\").trim();\n  }\n\n  for (const line of lines.slice(1)) {\n    const cols = splitCsvLine(line);\n    const playerId = cell(cols, \"PLAYERID\");\n    if (!playerId) continue;\n    if (byId.has(playerId)) continue;\n\n    const bats = normalizeBats(cell(cols, \"BATS\"));\n    const throws = normalizeThrows(cell(cols, \"THROWS\"));\n    const first_season = parseYearFromMmDdYyyy(cell(cols, \"PLAY.DEBUT\"));\n    const last_season = parseYearFromMmDdYyyy(cell(cols, \"PLAY.LASTGAME\"));\n    byId.set(playerId, { bats, throws, first_season, last_season });\n  }\n\n  return byId;\n}\n\nexport async function loadPlayerRegistry(): Promise<PlayerSummary[]> {\n  const registryStat = await fs.stat(PLAYER_REGISTRY_CSV_PATH);\n\n  let bioStat: { mtimeMs: number } | null = null;\n  try {\n    bioStat = await fs.stat(BIOFILE_CSV_PATH);\n  } catch {\n    bioStat = null;\n  }\n\n  if (\n    cache &&\n    cache.registryMtimeMs === registryStat.mtimeMs &&\n    cache.bioMtimeMs === (bioStat ? bioStat.mtimeMs : null)\n  ) {\n    return cache.players;\n  }\n\n  const registryRows = await loadPlayerRegistryRows();\n  if (!registryRows.length) {\n    cache = { registryMtimeMs: registryStat.mtimeMs, bioMtimeMs: bioStat?.mtimeMs ?? null, players: [] };\n    return [];\n  }\n\n  const bioById = bioStat ? await loadBioHands() : new Map();\n\n  const players: PlayerSummary[] = registryRows.map((r) => {\n    const bio = bioById.get(r.player_id);\n    return {\n      player_id: r.player_id,\n      player_name: r.player_name,\n      first_name: r.first_name,\n      last_name: r.last_name,\n      bats: bio?.bats ?? null,\n      throws: bio?.throws ?? null,\n      first_season: bio?.first_season ?? null,\n      last_season: bio?.last_season ?? null,\n    };\n  });\n\n  // Deterministic ordering.\n  players.sort((a, b) => {\n    if (a.player_name !== b.player_name) return a.player_name.localeCompare(b.player_name);\n    return a.player_id.localeCompare(b.player_id);\n  });\n\n  cache = {\n    registryMtimeMs: registryStat.mtimeMs,\n    bioMtimeMs: bioStat?.mtimeMs ?? null,\n    players,\n  };\n\n  return players;\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 560, "column": 0}, "map": {"version":3,"sources":["file:///Users/arnoldokoye/hotbat/src/app/api/today-games/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport fs from \"node:fs/promises\";\nimport path from \"node:path\";\n\nimport prisma from \"@/lib/prisma\";\nimport { loadBallparks } from \"@/lib/csv/ballparks\";\nimport { loadTeams } from \"@/lib/csv/teams\";\nimport { loadPlayerRegistry } from \"@/lib/csv/playerRegistry\";\n\ntype TodayGamesResponse = {\n  date: string;\n  games: {\n    id: number;\n    date: string;\n    startTimeLocal?: string;\n    homeTeamId: number;\n    awayTeamId: number;\n    homeTeamName: string;\n    awayTeamName: string;\n    homeTeamAbbrev: string;\n    awayTeamAbbrev: string;\n    homeTeamLogoUrl?: string;\n    awayTeamLogoUrl?: string;\n    parkName: string;\n    parkHrFactor?: number;\n    homePredictedHrMean?: number;\n    awayPredictedHrMean?: number;\n    hotbatScore?: number;\n    // Additional fields for frontend compatibility\n    homeTeam: string;\n    awayTeam: string;\n    homeProjectedHrMin: number;\n    homeProjectedHrMax: number;\n    awayProjectedHrMin: number;\n    awayProjectedHrMax: number;\n    homeStartingPitcher: {\n      name: string;\n      teamName: string;\n      throws: \"L\" | \"R\";\n      hrPer9: number;\n      era: number;\n    };\n    awayStartingPitcher: {\n      name: string;\n      teamName: string;\n      throws: \"L\" | \"R\";\n      hrPer9: number;\n      era: number;\n    };\n  }[];\n};\n\nconst DAILY_LOGS_DIR = path.join(process.cwd(), \"data_sources\", \"NEW_DATA_SETS\", \"2020-25 DAILY LOGS\");\n\nconst parseDate = (value: string | null) => {\n  if (!value) return null;\n  const parsed = new Date(`${value}T00:00:00.000Z`);\n  return Number.isNaN(parsed.getTime()) ? null : parsed;\n};\n\nconst toYyyymmdd = (iso: string) => iso.replaceAll(\"-\", \"\");\n\nconst formatStartTimeLocal = (raw: string | null | undefined) => {\n  const v = (raw ?? \"\").trim();\n  const m = /^(\\d{1,2}:\\d{2})(AM|PM)$/i.exec(v);\n  if (m) return `${m[1]} ${m[2].toUpperCase()}`;\n  return v || \"TBD\";\n};\n\nconst logoPath = (abbrev?: string | null) => {\n  return abbrev\n    ? `/team-logos/${abbrev.toLowerCase()}.svg`\n    : \"/team-logos/default.svg\";\n};\n\nconst logoFromRetrosheetTeam = (teamId: string) => {\n  const id = teamId.trim().toUpperCase();\n  // Minimal mapping for the currently-shipped logo set; everything else falls back safely.\n  if (id === \"NYA\") return logoPath(\"nyy\");\n  if (id === \"BOS\") return logoPath(\"bos\");\n  return logoPath(null);\n};\n\nconst safeNumber = (value: unknown, fallback = 0) => {\n  const n = typeof value === \"number\" ? value : Number.NaN;\n  return Number.isFinite(n) ? n : fallback;\n};\n\nconst computeHrPer9 = (hr: number, ipOuts: number) => {\n  if (ipOuts <= 0) return 0;\n  const innings = ipOuts / 3;\n  return (hr * 9) / innings;\n};\n\nconst computeEra = (er: number, ipOuts: number) => {\n  if (ipOuts <= 0) return 0;\n  const innings = ipOuts / 3;\n  return (er * 9) / innings;\n};\n\ntype CsvGameRow = {\n  gid: string;\n  visteam: string;\n  hometeam: string;\n  site: string;\n  starttime: string;\n  date: string; // YYYYMMDD\n};\n\ntype PitcherLine = {\n  pitcherId: string;\n  ipOuts: number;\n  er: number;\n  hr: number;\n};\n\nasync function loadTodayGamesFromCsv(dateIso: string): Promise<TodayGamesResponse> {\n  const year = Number.parseInt(dateIso.slice(0, 4), 10);\n  if (!Number.isFinite(year)) return { date: dateIso, games: [] };\n\n  const yyyymmdd = toYyyymmdd(dateIso);\n  const gameinfoPath = path.join(DAILY_LOGS_DIR, `${year}DAILY_LOGScsvs`, `${year}gameinfo.csv`);\n  const pitchingPath = path.join(DAILY_LOGS_DIR, `${year}DAILY_LOGScsvs`, `${year}pitching.csv`);\n\n  const [gameinfoText, pitchingText, teams, parks, playerRegistry] = await Promise.all([\n    fs.readFile(gameinfoPath, \"utf8\"),\n    fs.readFile(pitchingPath, \"utf8\"),\n    loadTeams().catch(() => []),\n    loadBallparks().catch(() => new Map<string, string>()),\n    loadPlayerRegistry().catch(() => []),\n  ]);\n\n  const teamNameById = new Map(teams.map((t) => [t.team_id, t.team_name] as const));\n  const playerById = new Map(\n    playerRegistry.map((p) => [p.player_id, { name: p.player_name, throws: p.throws }] as const),\n  );\n\n  const parseCsv = (text: string) => text.replace(/^\\uFEFF/, \"\").trim().split(/\\r?\\n/).filter(Boolean);\n\n  const gameinfoLines = parseCsv(gameinfoText);\n  if (gameinfoLines.length < 2) return { date: dateIso, games: [] };\n  const gameinfoHeader = gameinfoLines[0].split(\",\");\n  const giIdx = new Map(gameinfoHeader.map((h, i) => [h.trim(), i]));\n  const gi = (cols: string[], key: string) => {\n    const i = giIdx.get(key);\n    return i === undefined ? \"\" : (cols[i] ?? \"\").trim();\n  };\n\n  const games: CsvGameRow[] = [];\n  for (const line of gameinfoLines.slice(1)) {\n    const cols = line.split(\",\");\n    const date = gi(cols, \"date\");\n    if (date !== yyyymmdd) continue;\n    const gametype = gi(cols, \"gametype\");\n    if (gametype && gametype !== \"regular\") continue;\n    const gid = gi(cols, \"gid\");\n    const visteam = gi(cols, \"visteam\");\n    const hometeam = gi(cols, \"hometeam\");\n    const site = gi(cols, \"site\");\n    if (!gid || !visteam || !hometeam || !site) continue;\n    games.push({\n      gid,\n      visteam,\n      hometeam,\n      site,\n      starttime: gi(cols, \"starttime\"),\n      date,\n    });\n  }\n\n  if (!games.length) return { date: dateIso, games: [] };\n\n  // Load starters (p_seq == 1) for the day.\n  const pitchingLines = parseCsv(pitchingText);\n  const pitchingHeader = pitchingLines[0].split(\",\");\n  const pIdx = new Map(pitchingHeader.map((h, i) => [h.trim(), i]));\n  const pc = (cols: string[], key: string) => {\n    const i = pIdx.get(key);\n    return i === undefined ? \"\" : (cols[i] ?? \"\").trim();\n  };\n\n  const startersByGid = new Map<\n    string,\n    { home?: PitcherLine; away?: PitcherLine }\n  >();\n  for (const line of pitchingLines.slice(1)) {\n    const cols = line.split(\",\");\n    if (pc(cols, \"date\") !== yyyymmdd) continue;\n    if (pc(cols, \"p_seq\") !== \"1\") continue;\n    const gid = pc(cols, \"gid\");\n    const pitcherId = pc(cols, \"id\");\n    const vishome = pc(cols, \"vishome\");\n    if (!gid || !pitcherId || (vishome !== \"h\" && vishome !== \"v\")) continue;\n\n    const ipOuts = Number.parseInt(pc(cols, \"p_ipouts\"), 10);\n    const er = Number.parseInt(pc(cols, \"p_er\"), 10);\n    const hr = Number.parseInt(pc(cols, \"p_hr\"), 10);\n    const lineObj: PitcherLine = {\n      pitcherId,\n      ipOuts: Number.isFinite(ipOuts) ? ipOuts : 0,\n      er: Number.isFinite(er) ? er : 0,\n      hr: Number.isFinite(hr) ? hr : 0,\n    };\n\n    const entry = startersByGid.get(gid) ?? {};\n    if (vishome === \"h\") entry.home = lineObj;\n    if (vishome === \"v\") entry.away = lineObj;\n    startersByGid.set(gid, entry);\n  }\n\n  // Deterministic ordering: start time ascending, tie-breaker gid.\n  games.sort((a, b) => {\n    const at = formatStartTimeLocal(a.starttime);\n    const bt = formatStartTimeLocal(b.starttime);\n    if (at !== bt) return at.localeCompare(bt);\n    return a.gid.localeCompare(b.gid);\n  });\n\n  const deriveRange = () => ({ min: 0, max: 1 });\n\n  const outputGames: TodayGamesResponse[\"games\"] = games.map((g, idx) => {\n    const parkName = parks.get(g.site) ?? g.site;\n    const awayTeamName = teamNameById.get(g.visteam) ?? g.visteam;\n    const homeTeamName = teamNameById.get(g.hometeam) ?? g.hometeam;\n\n    const starters = startersByGid.get(g.gid);\n    const awayStarter = starters?.away;\n    const homeStarter = starters?.home;\n\n    const awayPitcherMeta = awayStarter ? playerById.get(awayStarter.pitcherId) : undefined;\n    const homePitcherMeta = homeStarter ? playerById.get(homeStarter.pitcherId) : undefined;\n\n    const awayThrows = awayPitcherMeta?.throws ?? \"R\";\n    const homeThrows = homePitcherMeta?.throws ?? \"R\";\n\n    const awayHrPer9 = awayStarter ? computeHrPer9(awayStarter.hr, awayStarter.ipOuts) : 0;\n    const homeHrPer9 = homeStarter ? computeHrPer9(homeStarter.hr, homeStarter.ipOuts) : 0;\n    const awayEra = awayStarter ? computeEra(awayStarter.er, awayStarter.ipOuts) : 0;\n    const homeEra = homeStarter ? computeEra(homeStarter.er, homeStarter.ipOuts) : 0;\n\n    const awayRange = deriveRange();\n    const homeRange = deriveRange();\n\n    return {\n      id: idx + 1,\n      date: dateIso,\n      startTimeLocal: formatStartTimeLocal(g.starttime),\n      homeTeamId: 0,\n      awayTeamId: 0,\n      homeTeamName,\n      awayTeamName,\n      homeTeamAbbrev: g.hometeam,\n      awayTeamAbbrev: g.visteam,\n      homeTeamLogoUrl: logoFromRetrosheetTeam(g.hometeam),\n      awayTeamLogoUrl: logoFromRetrosheetTeam(g.visteam),\n      parkName,\n      parkHrFactor: 1.0,\n      homePredictedHrMean: undefined,\n      awayPredictedHrMean: undefined,\n      hotbatScore: 0,\n      homeTeam: homeTeamName,\n      awayTeam: awayTeamName,\n      homeProjectedHrMin: homeRange.min,\n      homeProjectedHrMax: homeRange.max,\n      awayProjectedHrMin: awayRange.min,\n      awayProjectedHrMax: awayRange.max,\n      homeStartingPitcher: {\n        name: homePitcherMeta?.name ?? \"TBD\",\n        teamName: homeTeamName,\n        throws: homeThrows,\n        hrPer9: safeNumber(homeHrPer9, 0),\n        era: safeNumber(homeEra, 0),\n      },\n      awayStartingPitcher: {\n        name: awayPitcherMeta?.name ?? \"TBD\",\n        teamName: awayTeamName,\n        throws: awayThrows,\n        hrPer9: safeNumber(awayHrPer9, 0),\n        era: safeNumber(awayEra, 0),\n      },\n    };\n  });\n\n  return { date: dateIso, games: outputGames };\n}\n\nasync function loadTodayGamesFromDb(date: Date, endOfDay: Date, dateParam: string): Promise<TodayGamesResponse> {\n  const games = await prisma.game.findMany({\n    where: { date: { gte: date, lt: endOfDay } },\n    orderBy: { date: \"asc\" },\n    include: {\n      homeTeam: true,\n      awayTeam: true,\n      park: {\n        include: {\n          parkHrFactors: {\n            orderBy: { updatedAt: \"desc\" },\n            take: 1,\n          },\n        },\n      },\n      gamePredictions: true,\n    },\n  });\n\n  const getPitcherFromSnapshot = (\n    snapshot: unknown,\n    key: \"home_starting_pitcher\" | \"away_starting_pitcher\",\n  ) => {\n    if (!snapshot || typeof snapshot !== \"object\") return undefined;\n    const obj = snapshot as Record<string, unknown>;\n    const raw = obj[key];\n    if (!raw || typeof raw !== \"object\") return undefined;\n    const pitcher = raw as Record<string, unknown>;\n    const throws = pitcher.throws === \"L\" || pitcher.throws === \"R\" ? pitcher.throws : undefined;\n    const name = typeof pitcher.name === \"string\" ? pitcher.name : undefined;\n    const teamName = typeof pitcher.teamName === \"string\" ? pitcher.teamName : undefined;\n    const hrPer9 = typeof pitcher.hrPer9 === \"number\" ? pitcher.hrPer9 : undefined;\n    const era = typeof pitcher.era === \"number\" ? pitcher.era : undefined;\n    if (!name && !throws && hrPer9 === undefined && era === undefined) return undefined;\n    return { name, teamName, throws, hrPer9, era };\n  };\n\n  const response: TodayGamesResponse = {\n    date: dateParam,\n    games: games.map((game) => {\n      const homePrediction = game.gamePredictions.find(\n        (p) => p.teamId === game.homeTeamId,\n      );\n      const awayPrediction = game.gamePredictions.find(\n        (p) => p.teamId === game.awayTeamId,\n      );\n      const parkFactorEntry = game.park.parkHrFactors[0];\n      const hotbatScore =\n        game.gamePredictions.length > 0\n          ? game.gamePredictions.reduce(\n              (total, prediction) => total + prediction.hotbatScore,\n              0,\n            ) / game.gamePredictions.length\n          : undefined;\n\n      const deriveRange = (mean?: number, std?: number) => {\n        const m = mean ?? 0;\n        const s = std ?? 0;\n        const min = Math.max(0, Number((m - s).toFixed(1)));\n        const max = Math.max(min, Number((m + s).toFixed(1)) || m || 1);\n        return { min, max };\n      };\n\n      const homeRange = deriveRange(\n        homePrediction?.predictedHrMean ?? undefined,\n        homePrediction?.predictedHrStd ?? undefined,\n      );\n      const awayRange = deriveRange(\n        awayPrediction?.predictedHrMean ?? undefined,\n        awayPrediction?.predictedHrStd ?? undefined,\n      );\n\n      const defaultPitcher = {\n        name: \"TBD\",\n        teamName: \"\",\n        throws: \"R\" as const,\n        hrPer9: 0,\n        era: 0,\n      };\n\n      const homePitcherSnapshot = getPitcherFromSnapshot(\n        homePrediction?.featuresSnapshot,\n        \"home_starting_pitcher\",\n      );\n      const awayPitcherSnapshot = getPitcherFromSnapshot(\n        awayPrediction?.featuresSnapshot,\n        \"away_starting_pitcher\",\n      );\n\n      return {\n        id: game.id,\n        date: dateParam,\n        startTimeLocal: game.startTime?.toISOString(),\n        homeTeamId: game.homeTeamId,\n        awayTeamId: game.awayTeamId,\n        homeTeamName: game.homeTeam.name,\n        awayTeamName: game.awayTeam.name,\n        homeTeamAbbrev: game.homeTeam.abbrev,\n        awayTeamAbbrev: game.awayTeam.abbrev,\n        homeTeamLogoUrl: logoPath(game.homeTeam.abbrev),\n        awayTeamLogoUrl: logoPath(game.awayTeam.abbrev),\n        parkName: game.park.name,\n        parkHrFactor:\n          parkFactorEntry?.hrFactor ?? game.park.defaultHrFactor ?? 1.0,\n        homePredictedHrMean: homePrediction?.predictedHrMean ?? undefined,\n        awayPredictedHrMean: awayPrediction?.predictedHrMean ?? undefined,\n        hotbatScore: hotbatScore ?? 0,\n        homeTeam: game.homeTeam.name,\n        awayTeam: game.awayTeam.name,\n        homeProjectedHrMin: homeRange.min,\n        homeProjectedHrMax: homeRange.max,\n        awayProjectedHrMin: awayRange.min,\n        awayProjectedHrMax: awayRange.max,\n        homeStartingPitcher: {\n          name: homePitcherSnapshot?.name ?? defaultPitcher.name,\n          teamName: homePitcherSnapshot?.teamName ?? game.homeTeam.name,\n          throws: homePitcherSnapshot?.throws ?? defaultPitcher.throws,\n          hrPer9: homePitcherSnapshot?.hrPer9 ?? defaultPitcher.hrPer9,\n          era: homePitcherSnapshot?.era ?? defaultPitcher.era,\n        },\n        awayStartingPitcher: {\n          name: awayPitcherSnapshot?.name ?? defaultPitcher.name,\n          teamName: awayPitcherSnapshot?.teamName ?? game.awayTeam.name,\n          throws: awayPitcherSnapshot?.throws ?? defaultPitcher.throws,\n          hrPer9: awayPitcherSnapshot?.hrPer9 ?? defaultPitcher.hrPer9,\n          era: awayPitcherSnapshot?.era ?? defaultPitcher.era,\n        },\n      };\n    }),\n  };\n\n  return response;\n}\n\nexport async function GET(req: NextRequest) {\n  const { searchParams } = new URL(req.url);\n  const dateParam = searchParams.get(\"date\");\n  const date = parseDate(dateParam);\n\n  if (!dateParam || !date) {\n    return NextResponse.json(\n      { error: \"date query param is required (YYYY-MM-DD)\" },\n      { status: 400 },\n    );\n  }\n\n  const endOfDay = new Date(date);\n  endOfDay.setUTCDate(endOfDay.getUTCDate() + 1);\n\n  const mode = (process.env.HOTBAT_BACKEND ?? \"auto\").toLowerCase();\n\n  if (mode === \"csv\") {\n    const csv = await loadTodayGamesFromCsv(dateParam);\n    return NextResponse.json(csv, { status: 200, headers: { \"x-hotbat-source\": \"csv\" } });\n  }\n\n  try {\n    const db = await loadTodayGamesFromDb(date, endOfDay, dateParam);\n    return NextResponse.json(db, { status: 200, headers: { \"x-hotbat-source\": \"db\" } });\n  } catch (error) {\n    console.error(\"today-games handler error\", error);\n    if (mode === \"auto\") {\n      try {\n        const csv = await loadTodayGamesFromCsv(dateParam);\n        return NextResponse.json(csv, { status: 200, headers: { \"x-hotbat-source\": \"csv\" } });\n      } catch (csvError) {\n        console.error(\"today-games csv fallback error\", csvError);\n      }\n    }\n    const fallback: TodayGamesResponse = { date: dateParam, games: [] };\n    return NextResponse.json(fallback, { status: 200, headers: { \"x-hotbat-error\": \"1\" } });\n  }\n}\n"],"names":[],"mappings":"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"}}]
}