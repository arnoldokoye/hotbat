{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file:///Users/arnoldokoye/hotbat/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\nimport { PrismaPg } from \"@prisma/adapter-pg\";\nimport { Pool } from \"pg\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nconst connectionString = process.env.DATABASE_URL;\nif (!connectionString) {\n  throw new Error(\"DATABASE_URL is required to initialize Prisma\");\n}\n\n// Ensure a single PrismaClient/Pool instance across hot reloads in dev.\nconst globalForPrisma = globalThis as unknown as {\n  prisma?: PrismaClient;\n  pool?: Pool;\n  adapter?: PrismaPg;\n};\n\nconst defaultCaPath =\n  process.env.NODE_EXTRA_CA_CERTS ||\n  path.join(process.cwd(), \"prod-ca-2021.crt\");\nconst sslConfig: { rejectUnauthorized: boolean; ca?: Buffer } = {\n  rejectUnauthorized: true,\n};\nif (fs.existsSync(defaultCaPath)) {\n  sslConfig.ca = fs.readFileSync(defaultCaPath);\n}\n\n// Create a Pool with SSL verification enabled; rely on system trust or NODE_EXTRA_CA_CERTS for Supabase CA.\nconst pool =\n  globalForPrisma.pool ??\n  new Pool({\n    connectionString,\n    ssl: sslConfig,\n  });\nconst adapter = globalForPrisma.adapter ?? new PrismaPg(pool);\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    adapter,\n    log: process.env.NODE_ENV === \"development\" ? [\"warn\", \"error\"] : [\"error\"],\n  });\n\nif (process.env.NODE_ENV !== \"production\") {\n  globalForPrisma.pool = pool;\n  globalForPrisma.adapter = adapter;\n  globalForPrisma.prisma = prisma;\n}\n\nexport default prisma;\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;AAEA,MAAM,mBAAmB,QAAQ,GAAG,CAAC,YAAY;AACjD,IAAI,CAAC,kBAAkB;IACrB,MAAM,IAAI,MAAM;AAClB;AAEA,wEAAwE;AACxE,MAAM,kBAAkB;AAMxB,MAAM,gBACJ,QAAQ,GAAG,CAAC,mBAAmB,IAC/B,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;AAC3B,MAAM,YAA0D;IAC9D,oBAAoB;AACtB;AACA,IAAI,wGAAE,CAAC,UAAU,CAAC,gBAAgB;IAChC,UAAU,EAAE,GAAG,wGAAE,CAAC,YAAY,CAAC;AACjC;AAEA,4GAA4G;AAC5G,MAAM,OACJ,gBAAgB,IAAI,IACpB,IAAI,4GAAI,CAAC;IACP;IACA,KAAK;AACP;AACF,MAAM,UAAU,gBAAgB,OAAO,IAAI,IAAI,yKAAQ,CAAC;AAEjD,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf;IACA,KAAK,uCAAyC;QAAC;QAAQ;KAAQ,GAAG;AACpE;AAEF,wCAA2C;IACzC,gBAAgB,IAAI,GAAG;IACvB,gBAAgB,OAAO,GAAG;IAC1B,gBAAgB,MAAM,GAAG;AAC3B;uCAEe"}},
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///Users/arnoldokoye/hotbat/src/app/api/hr-picks/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport prisma from \"@/lib/prisma\";\n\ntype HrPick = {\n  rank: number;\n  playerId: number;\n  playerName: string;\n  teamAbbrev: string;\n  hotbatScore: number;\n  pickScore: number;\n  reasons: string[];\n  parkName?: string;\n  parkHrFactor?: number;\n  hrPerPa?: number;\n  seasonHr?: number;\n};\n\ntype HrPicksResponse = {\n  date: string;\n  picks: HrPick[];\n};\n\nconst parseDate = (value: string | null) => {\n  if (!value) return null;\n  const parsed = new Date(`${value}T00:00:00.000Z`);\n  return Number.isNaN(parsed.getTime()) ? null : parsed;\n};\n\nexport async function GET(req: NextRequest) {\n  const { searchParams } = new URL(req.url);\n  const dateParam = searchParams.get(\"date\");\n  const date = parseDate(dateParam);\n\n  if (!dateParam || !date) {\n    return NextResponse.json(\n      { error: \"date query param is required (YYYY-MM-DD)\" },\n      { status: 400 },\n    );\n  }\n\n  const endOfDay = new Date(date);\n  endOfDay.setUTCDate(endOfDay.getUTCDate() + 1);\n\n  try {\n    const games = await prisma.game.findMany({\n      where: { date: { gte: date, lt: endOfDay } },\n      orderBy: { date: \"asc\" },\n      include: {\n        homeTeam: true,\n        awayTeam: true,\n        park: {\n          include: {\n            parkHrFactors: {\n              orderBy: { updatedAt: \"desc\" },\n              take: 1,\n            },\n          },\n        },\n        gamePredictions: true,\n      },\n    });\n\n    if (!games || games.length === 0) {\n      const empty: HrPicksResponse = { date: dateParam, picks: [] };\n      return NextResponse.json(empty, { status: 200 });\n    }\n\n    const season = games[0].season;\n    const teamIds = Array.from(\n      new Set(games.flatMap((g) => [g.homeTeamId, g.awayTeamId])),\n    );\n\n    const players = await prisma.player.findMany({\n      where: { teamId: { in: teamIds } },\n      include: {\n        team: true,\n        hrSummaries: {\n          where: { season },\n        },\n      },\n    });\n\n    const predictionsByTeam = new Map<number, number>();\n    for (const game of games) {\n      for (const pred of game.gamePredictions) {\n        predictionsByTeam.set(pred.teamId, pred.hotbatScore);\n      }\n    }\n\n    const parkFactorsByTeam = new Map<number, { parkName: string; hrFactor?: number }>();\n    for (const game of games) {\n      const parkFactorEntry = game.park.parkHrFactors[0];\n      const factor = parkFactorEntry?.hrFactor ?? game.park.defaultHrFactor ?? undefined;\n      parkFactorsByTeam.set(game.homeTeamId, { parkName: game.park.name, hrFactor: factor });\n      parkFactorsByTeam.set(game.awayTeamId, { parkName: game.park.name, hrFactor: factor });\n    }\n\n    const picksUnsorted: Omit<HrPick, \"rank\">[] = [];\n\n    for (const player of players) {\n      const overallSummary = player.hrSummaries.find((s) => s.splitKey === \"overall\");\n      const hrPerPa = Number.isFinite(overallSummary?.hrPerPa ?? 0)\n        ? (overallSummary?.hrPerPa as number)\n        : 0;\n      const hr = Number.isFinite(overallSummary?.hr ?? 0) ? (overallSummary?.hr as number) : 0;\n\n      const hotbatScore = predictionsByTeam.get(player.teamId) ?? 0;\n      // Deterministic, player-informed ranking: team HotBat score + HR/PA + HR tiebreak.\n      const pickScore = hotbatScore + hrPerPa * 100 + hr * 0.1;\n      const parkInfo = parkFactorsByTeam.get(player.teamId);\n\n      const reasons: string[] = [];\n      if (hotbatScore >= 75) {\n        reasons.push(`Elite power profile (team HotBat Score ${hotbatScore.toFixed(1)})`);\n      } else if (hotbatScore > 0) {\n        reasons.push(`Team HotBat Score ${hotbatScore.toFixed(1)}`);\n      }\n      if (parkInfo?.hrFactor && parkInfo.hrFactor > 1.1) {\n        reasons.push(`HR-friendly park at ${parkInfo.parkName}`);\n      }\n      if (hrPerPa >= 0.25) {\n        reasons.push(`Strong HR/PA (${hrPerPa.toFixed(3)})`);\n      }\n      if (hr > 0 && reasons.length < 3) {\n        reasons.push(`Season HR total ${hr}`);\n      }\n      if (!reasons.length && parkInfo?.parkName) {\n        reasons.push(`Playing at ${parkInfo.parkName}`);\n      }\n\n      picksUnsorted.push({\n        playerId: player.id,\n        playerName: `${player.firstName} ${player.lastName}`,\n        teamAbbrev: player.team.abbrev,\n        hotbatScore,\n        pickScore,\n        reasons,\n        parkName: parkInfo?.parkName,\n        parkHrFactor: parkInfo?.hrFactor,\n        hrPerPa,\n        seasonHr: hr,\n      });\n    }\n\n    const sorted = picksUnsorted\n      .sort((a, b) => {\n        if (b.pickScore !== a.pickScore) return b.pickScore - a.pickScore;\n        if (b.hotbatScore !== a.hotbatScore) return b.hotbatScore - a.hotbatScore;\n        if (b.reasons.length !== a.reasons.length) return b.reasons.length - a.reasons.length;\n        return b.playerName.localeCompare(a.playerName);\n      })\n      .slice(0, 5);\n\n    const picks: HrPick[] = sorted.map((p, idx) => ({\n      rank: idx + 1,\n      ...p,\n    }));\n\n    const response: HrPicksResponse = { date: dateParam, picks };\n    return NextResponse.json(response, { status: 200 });\n  } catch (error) {\n    console.error(\"hr-picks handler error\", error);\n    const fallback: HrPicksResponse = { date: dateParam ?? \"\", picks: [] };\n    return NextResponse.json(fallback, { status: 500, headers: { \"x-hotbat-error\": \"1\" } });\n  }\n}\n"],"names":[],"mappings":"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"}}]
}